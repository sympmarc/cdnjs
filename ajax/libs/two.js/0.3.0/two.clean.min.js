(function(){function m(){var a=document.body.getBoundingClientRect(),b=this.width=a.width,a=this.height=a.height;this.renderer.setSize(b,a,this.ratio);this.trigger(f.Events.resize,b,a)}var n=this,c=n.Two||{},g=Math.sin,l=Math.cos,b=Math.atan2,d=Math.sqrt,k=Math.abs,a=Math.PI,e=2*a,h=a/2,p=Math.pow,r={hasEventListeners:_.isFunction(n.addEventListener),bind:function(a,b,e,f){this.hasEventListeners?a.addEventListener(b,e,!!f):a.attachEvent("on"+b,e);return this},unbind:function(a,b,e,f){this.hasEventListeners?
a.removeEventListeners(b,e,!!f):a.detachEvent("on"+b,e);return this}},f=n.Two=function(a){a=_.defaults(a||{},{fullscreen:!1,width:640,height:480,type:f.Types.svg,autostart:!1});_.each(a,function(a,b){"fullscreen"!==b&&"width"!==b&&"height"!==b&&"autostart"!==b&&(this[b]=a)},this);_.isElement(a.domElement)&&(this.type=f.Types[a.domElement.tagName.toLowerCase()]);this.renderer=new f[this.type](this);f.Utils.setPlaying.call(this,a.autostart);this.frameCount=0;a.fullscreen?(a=_.bind(m,this),_.extend(document.body.style,
{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),_.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),r.bind(n,"resize",a),a()):_.isElement(a.domElement)||(this.renderer.setSize(a.width,a.height,this.ratio),this.width=a.width,this.height=a.height);this.scene=new f.Group;this.renderer.add(this.scene);f.Instances.push(this)};_.extend(f,{Array:n.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",
canvas:"CanvasRenderer"},Version:"v0.3.0",Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change",remove:"remove",insert:"insert"},Commands:{move:"M",line:"L",curve:"C",close:"Z"},Resolution:8,Instances:[],noConflict:function(){n.Two=c;return this},Utils:{Curve:{CollinearityEpsilon:p(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:0.25,angle:0,epsilon:0.01}},setPlaying:function(a){_.defer(_.bind(function(){this.playing=
!!a},this))},getComputedMatrix:function(a){for(var b=new f.Matrix;a&&a._matrix;){var e=a._matrix.elements;b.multiply(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]);a=a.parent}return b},applySvgAttributes:function(a,b){b.cap="butt";b.join="bevel";_.each(a.attributes,function(a,e){switch(a.nodeName){case "visibility":b.visible=!!a.nodeValue;break;case "stroke-linecap":b.cap=a.nodeValue;break;case "stroke-linejoin":b.join=a.nodeValue;break;case "stroke-miterlimit":b.miter=a.nodeValue;break;case "stroke-width":b.linewidth=
parseFloat(a.nodeValue);break;case "stroke-opacity":case "fill-opacity":b.opacity=a.nodeValue;break;case "fill":b.fill=a.nodeValue;break;case "stroke":b.stroke=a.nodeValue}});return b},read:{svg:function(){return f.Utils.read.g.apply(this,arguments)},g:function(a){var b=new f.Group;this.add(b);_.each(a.childNodes,function(a){var e=a.nodeName;e&&(e=e.replace(/svg\:/ig,"").toLowerCase(),e in f.Utils.read&&(a=f.Utils.read[e].call(this,a),b.add(a)))},this);return f.Utils.applySvgAttributes(a,b)},polygon:function(a,
b){var e=[];a.getAttribute("points").replace(/([\d\.?]+),([\d\.?]+)/g,function(a,b,d){e.push(new f.Anchor(parseFloat(b),parseFloat(d)))});var d=(new f.Polygon(e,!b)).noStroke();return f.Utils.applySvgAttributes(a,d)},polyline:function(a){return f.Utils.read.polygon(a,!0)},path:function(a){var b,e,d,c=!1,h=!1,l=a.getAttribute("d").match(/[a-df-z][^a-df-z]*/ig),p=l.length-1,l=_.flatten(_.map(l,function(a,l){var v,k,g=a[0],r=g.toLowerCase();d=a.slice(1).trim();d=d.replace(/(-?\d+(?:\.\d*)?)[eE]([+\-]?\d+)/g,
function(a,b,e){return parseFloat(b)*Math.pow(10,e)});d=d.split(/[\s,]+|(?=\s?[+\-])/);c=g===r;var u,s,q,t;switch(r){case "z":l>=p?h=!0:(k=b.x,v=b.y,v=new f.Anchor(k,v,void 0,void 0,void 0,void 0,f.Commands.close));break;case "m":case "l":k=parseFloat(d[0]);v=parseFloat(d[1]);v=new f.Anchor(k,v,void 0,void 0,void 0,void 0,"m"===r?f.Commands.move:f.Commands.line);c&&v.addSelf(b);b=v;break;case "h":case "v":k="h"===r?"x":"y";g="x"===k?"y":"x";v=new f.Anchor(void 0,void 0,void 0,void 0,void 0,void 0,
f.Commands.line);v[k]=parseFloat(d[0]);v[g]=b[g];c&&(v[k]+=b[k]);b=v;break;case "s":case "c":v=b.x;g=b.y;e||(e=(new f.Vector).copy(b));"c"===r?(u=parseFloat(d[0]),k=parseFloat(d[1]),r=parseFloat(d[2]),s=parseFloat(d[3]),q=parseFloat(d[4]),t=parseFloat(d[5])):(s=f.Utils.getReflection(b,e,c),u=s.x,k=s.y,r=parseFloat(d[0]),s=parseFloat(d[1]),q=parseFloat(d[2]),t=parseFloat(d[3]));c&&(u+=v,k+=g,r+=v,s+=g,q+=v,t+=g);_.isObject(b.controls)||f.Anchor.AppendCurveProperties(b);b.controls.right.set(u,k);b=
v=new f.Anchor(q,t,r,s,void 0,void 0,f.Commands.curve);e=v.controls.left;break;case "t":case "q":v=b.x;g=b.y;e||(e=(new f.Vector).copy(b));e.isZero()?(u=v,k=g):(u=e.x,g=e.y);"q"===r?(r=parseFloat(d[0]),s=parseFloat(d[1]),q=parseFloat(d[1]),t=parseFloat(d[2])):(s=f.Utils.getReflection(b,e,c),r=s.x,s=s.y,q=parseFloat(d[0]),t=parseFloat(d[1]));c&&(u+=v,k+=g,r+=v,s+=g,q+=v,t+=g);_.isObject(b.controls)||f.Anchor.AppendCurveProperties(b);b.controls.right.set(u,k);b=v=new f.Anchor(q,t,r,s,void 0,void 0,
f.Commands.curve);e=v.controls.left;break;case "a":throw new f.Utils.Error("not yet able to interpret Elliptical Arcs.");}return v}));if(!(1>=l.length))return l=_.compact(l),l=(new f.Polygon(l,h,void 0,!0)).noStroke(),f.Utils.applySvgAttributes(a,l)},circle:function(a){var b=parseFloat(a.getAttribute("cx")),d=parseFloat(a.getAttribute("cy")),c=parseFloat(a.getAttribute("r")),k=f.Resolution,h=_.map(_.range(k),function(a){var b=a/k*e;a=c*l(b);b=c*g(b);return new f.Anchor(a,b)},this),h=(new f.Polygon(h,
!0,!0)).noStroke();h.translation.set(b,d);return f.Utils.applySvgAttributes(a,h)},ellipse:function(a){var b=parseFloat(a.getAttribute("cx")),d=parseFloat(a.getAttribute("cy")),c=parseFloat(a.getAttribute("rx")),h=parseFloat(a.getAttribute("ry")),k=f.Resolution,p=_.map(_.range(k),function(a){var b=a/k*e;a=c*l(b);b=h*g(b);return new f.Anchor(a,b)},this),p=(new f.Polygon(p,!0,!0)).noStroke();p.translation.set(b,d);return f.Utils.applySvgAttributes(a,p)},rect:function(a){var b=parseFloat(a.getAttribute("x")),
e=parseFloat(a.getAttribute("y")),d=parseFloat(a.getAttribute("width")),c=parseFloat(a.getAttribute("height")),d=d/2,c=c/2,h=[new f.Anchor(d,c),new f.Anchor(-d,c),new f.Anchor(-d,-c),new f.Anchor(d,-c)],h=(new f.Polygon(h,!0)).noStroke();h.translation.set(b+d,e+c);return f.Utils.applySvgAttributes(a,h)},line:function(a){var b=parseFloat(a.getAttribute("x1")),e=parseFloat(a.getAttribute("y1")),d=parseFloat(a.getAttribute("x2")),c=parseFloat(a.getAttribute("y2")),d=(d-b)/2,c=(c-e)/2,h=[new f.Anchor(-d,
-c),new f.Anchor(d,c)],h=(new f.Polygon(h)).noFill();h.translation.set(b+d,e+c);return f.Utils.applySvgAttributes(a,h)}},subdivide:function(d,c,h,l,p,r,g,u,s){var q=f.Utils.Curve.CollinearityEpsilon,t=f.Utils.Curve.RecursionLimit,n=f.Utils.Curve.CuspLimit,w=f.Utils.Curve.Tolerance,m;s=s||0;if(s>t)return[];var t=(d+h)/2,M=(c+l)/2,H=(h+p)/2,I=(l+r)/2,N=(p+g)/2,J=(r+u)/2,K=(t+H)/2,L=(M+I)/2,H=(H+N)/2,I=(I+J)/2,B=(K+H)/2,C=(L+I)/2;m=g-d;var y=u-c,F=k((h-g)*y-(l-u)*m),G=k((p-g)*y-(r-u)*m);if(0<s){if(F>
q&&G>q&&(F+G)*(F+G)<=w.distance*(m*m+y*y)){if(w.angle<w.epsilon)return[new f.Anchor(B,C)];m=b(r-l,p-h);q=k(m-b(l-c,h-d));m=k(b(u-r,g-p)-m);q>=a&&(q=e-q);m>=a&&(m=e-m);if(q+m<w.angle)return[new f.Anchor(B,C)];if(0!==n){if(q>n)return[new f.Anchor(h,l)];if(m>n)return[new f.Anchor(p,r)]}}}else if(F>q)if(F*F<=w.distance*(m*m+y*y)){if(w.angle<w.epsilon)return[new f.Anchor(B,C)];q=k(b(r-l,p-h)-b(l-c,h-d));q>=a&&(q=e-q);if(q<w.angle)return[new f.Anchor(h,l),new f.Anchor(p,r)];if(0!==n&&q>n)return[new f.Anchor(h,
l)]}else if(G>q){if(G*G<=w.distance*(m*m+y*y)){if(w.angle<w.epsilon)return[new f.Anchor(B,C)];q=k(b(u-r,g-p)-b(r-l,p-h));q>=a&&(q=e-q);if(q<w.angle)return[new f.Anchor(h,l),new f.Anchor(p,r)];if(0!==n&&q>n)return[new f.Anchor(p,r)]}}else if(m=B-(d+g)/2,y=C-(c+u)/2,m*m+y*y<=w.distance)return[new f.Anchor(B,C)];return f.Utils.subdivide(d,c,t,M,K,L,B,C,s+1).concat(f.Utils.subdivide(B,C,H,I,N,J,g,u,s+1))},getCurveFromPoints:function(a,b){for(var e=a.length,d=e-1,c=0;c<e;c++){var h=a[c];_.isObject(h.controls)||
f.Anchor.AppendCurveProperties(h);var l=b?w(c-1,e):Math.max(c-1,0),p=b?w(c+1,e):Math.min(c+1,d);t(a[l],h,a[p]);h._command=0===c?f.Commands.move:f.Commands.curve;h.controls.left.x=_.isNumber(h.controls.left.x)?h.controls.left.x:h.x;h.controls.left.y=_.isNumber(h.controls.left.y)?h.controls.left.y:h.y;h.controls.right.x=_.isNumber(h.controls.right.x)?h.controls.right.x:h.x;h.controls.right.y=_.isNumber(h.controls.right.y)?h.controls.right.y:h.y}},getControlPoints:function(b,e,d){var c=q(b,e),p=q(d,
e);b=u(b,e);d=u(d,e);var k=(c+p)/2;e.u=_.isObject(e.controls.left)?e.controls.left:new f.Vector(e.x,e.y);e.v=_.isObject(e.controls.right)?e.controls.right:new f.Vector(e.x,e.y);if(1E-4>b||1E-4>d)return e.controls.left.copy(e),e.controls.right.copy(e),e;b*=0.33;d*=0.33;k=p<c?k+h:k-h;e.controls.left.x=e.x+l(k)*b;e.controls.left.y=e.y+g(k)*b;k-=a;e.controls.right.x=e.x+l(k)*d;e.controls.right.y=e.y+g(k)*d;return e},getReflection:function(a,b,e){var d=a.distanceTo(b);if(1E-4>=d)return e?new f.Vector:
a.clone();b=q(a,b);return new f.Vector(d*Math.cos(b)+(e?0:a.x),d*Math.sin(b)+(e?0:a.y))},angleBetween:function(a,e){return b(a.y-e.y,a.x-e.x)},distanceBetweenSquared:function(a,b){var e=a.x-b.x,d=a.y-b.y;return e*e+d*d},distanceBetween:function(a,b){return d(s(a,b))},mod:function(a,b){for(;0>a;)a+=b;return a%b},Collection:function(){Array.call(this);1<arguments.length?Array.prototype.push.apply(this,arguments):arguments[0]&&Array.isArray(arguments[0])&&Array.prototype.push.apply(this,arguments[0])},
Error:function(a){this.name="two.js";this.message=a}}});f.Utils.Error.prototype=Error();f.Utils.Error.prototype.constructor=f.Utils.Error;f.Utils.Collection.prototype=[];f.Utils.Collection.constructor=f.Utils.Collection;_.extend(f.Utils.Collection.prototype,Backbone.Events,{pop:function(){var a=Array.prototype.pop.apply(this,arguments);this.trigger(f.Events.remove,[a]);return a},shift:function(){var a=Array.prototype.shift.apply(this,arguments);this.trigger(f.Events.remove,[a]);return a},push:function(){var a=
Array.prototype.push.apply(this,arguments);this.trigger(f.Events.insert,arguments);return a},unshift:function(){var a=Array.prototype.unshift.apply(this,arguments);this.trigger(f.Events.insert,arguments);return a},splice:function(){var a=Array.prototype.splice.apply(this,arguments),b;this.trigger(f.Events.remove,a);2<arguments.length&&(b=this.slice(arguments[0],arguments.length-2),this.trigger(f.Events.insert,b));return a}});var u=f.Utils.distanceBetween,s=f.Utils.distanceBetweenSquared,q=f.Utils.angleBetween,
t=f.Utils.getControlPoints,w=f.Utils.mod;_.extend(f.prototype,Backbone.Events,{appendTo:function(a){a.appendChild(this.renderer.domElement);return this},play:function(){f.Utils.setPlaying.call(this,!0);return this.trigger(f.Events.play)},pause:function(){this.playing=!1;return this.trigger(f.Events.pause)},update:function(){var a=!!this._lastFrame,b=(n.performance&&n.performance.now?n.performance:Date).now();this.frameCount++;a&&(this.timeDelta=parseFloat((b-this._lastFrame).toFixed(3)));this._lastFrame=
b;var a=this.width,b=this.height,e=this.renderer;a===e.width&&b===e.height||e.setSize(a,b,this.ratio);this.trigger(f.Events.update,this.frameCount,this.timeDelta);_.defer(_.bind(function(){this.render()},this));return this},render:function(){this.renderer.render();return this.trigger(f.Events.render,this.frameCount)},add:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));this.scene.add(b);return this},remove:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));this.scene.remove(b);return this},
clear:function(){_.each(this.scene.children,function(a){a.remove()});return this},makeLine:function(a,b,e,d){e=(e-a)/2;d=(d-b)/2;var h=[new f.Anchor(-e,-d),new f.Anchor(e,d)],h=(new f.Polygon(h)).noFill();h.translation.set(a+e,b+d);this.scene.add(h);return h},makeRectangle:function(a,b,e,d){e/=2;d/=2;d=[new f.Anchor(e,d),new f.Anchor(-e,d),new f.Anchor(-e,-d),new f.Anchor(e,-d)];d=new f.Polygon(d,!0);d.translation.set(a,b);this.scene.add(d);return d},makeCircle:function(a,b,e){return this.makeEllipse(a,
b,e,e)},makeEllipse:function(a,b,d,h){var c=f.Resolution,k=_.map(_.range(c),function(a){var b=a/c*e;a=d*l(b);b=h*g(b);return new f.Anchor(a,b)},this),k=new f.Polygon(k,!0,!0);k.translation.set(a,b);this.scene.add(k);return k},makeCurve:function(a){var b=arguments.length,e=a;if(!_.isArray(a))for(var e=[],d=0;d<b;d+=2){var h=arguments[d];if(!_.isNumber(h))break;e.push(new f.Anchor(h,arguments[d+1]))}var b=arguments[b-1],e=new f.Polygon(e,!(_.isBoolean(b)&&b),!0),b=e.getBoundingClientRect(),c=b.left+
b.width/2,k=b.top+b.height/2;_.each(e.vertices,function(a){a.x-=c;a.y-=k});e.translation.set(c,k);this.scene.add(e);return e},makePolygon:function(a){var b=arguments.length,e=a;if(!_.isArray(a))for(var e=[],d=0;d<b;d+=2){var h=arguments[d];if(!_.isNumber(h))break;e.push(new f.Anchor(h,arguments[d+1]))}b=arguments[b-1];e=new f.Polygon(e,!(_.isBoolean(b)&&b));b=e.getBoundingClientRect();e.center().translation.set(b.left+b.width/2,b.top+b.height/2);this.scene.add(e);return e},makeGroup:function(a){var b=
a;_.isArray(a)||(b=_.toArray(arguments));var e=new f.Group;this.scene.add(e);e.add(b);return e},interpret:function(a){var b=a.tagName.toLowerCase();if(!(b in f.Utils.read))return null;a=f.Utils.read[b].call(this,a);this.add(a);return a}});(function(){_.each(f.Instances,function(a){a.playing&&a.update()});requestAnimationFrame(arguments.callee)})();"function"===typeof define&&define.amd?define(function(){return f}):"undefined"!=typeof module&&module.exports&&(module.exports=f)})();
(function(){var m=Two.Vector=function(c,g){this.x=c||0;this.y=g||0};_.extend(m,{MakeGetterSetter:function(c,g,l){var b="_"+g;Object.defineProperty(c,g,{get:function(){return this[b]},set:function(d){this[b]=d;this.trigger(Two.Events.change,g)}});c[b]=l}});_.extend(m.prototype,Backbone.Events,{set:function(c,g){this.x=c;this.y=g;return this},copy:function(c){this.x=c.x;this.y=c.y;return this},clear:function(){this.y=this.x=0;return this},clone:function(){return new m(this.x,this.y)},add:function(c,
g){this.x=c.x+g.x;this.y=c.y+g.y;return this},addSelf:function(c){this.x+=c.x;this.y+=c.y;return this},sub:function(c,g){this.x=c.x-g.x;this.y=c.y-g.y;return this},subSelf:function(c){this.x-=c.x;this.y-=c.y;return this},multiplySelf:function(c){this.x*=c.x;this.y*=c.y;return this},multiplyScalar:function(c){this.x*=c;this.y*=c;return this},divideScalar:function(c){c?(this.x/=c,this.y/=c):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this.x*c.x+
this.y*c.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(c){return Math.sqrt(this.distanceToSquared(c))},distanceToSquared:function(c){var g=this.x-c.x;c=this.y-c.y;return g*g+c*c},setLength:function(c){return this.normalize().multiplyScalar(c)},equals:function(c){return 1E-4>this.distanceTo(c)},lerp:function(c,g){return this.set((c.x-this.x)*
g+this.x,(c.y-this.y)*g+this.y)},isZero:function(){return 1E-4>this.length()},toString:function(){return this.x+","+this.y},toObject:function(){return{x:this.x,y:this.y}}});var n={set:function(c,g){this._x=c;this._y=g;return this.trigger(Two.Events.change)},copy:function(c){this._x=c.x;this._y=c.y;return this.trigger(Two.Events.change)},clear:function(){this._y=this._x=0;return this.trigger(Two.Events.change)},clone:function(){return new m(this._x,this._y)},add:function(c,g){this._x=c.x+g.x;this._y=
c.y+g.y;return this.trigger(Two.Events.change)},addSelf:function(c){this._x+=c.x;this._y+=c.y;return this.trigger(Two.Events.change)},sub:function(c,g){this._x=c.x-g.x;this._y=c.y-g.y;return this.trigger(Two.Events.change)},subSelf:function(c){this._x-=c.x;this._y-=c.y;return this.trigger(Two.Events.change)},multiplySelf:function(c){this._x*=c.x;this._y*=c.y;return this.trigger(Two.Events.change)},multiplyScalar:function(c){this._x*=c;this._y*=c;return this.trigger(Two.Events.change)},divideScalar:function(c){return c?
(this._x/=c,this._y/=c,this.trigger(Two.Events.change)):this.clear()},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this._x*c.x+this._y*c.y},lengthSquared:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(c){return Math.sqrt(this.distanceToSquared(c))},distanceToSquared:function(c){var g=this._x-c.x;c=this._y-c.y;return g*g+c*c},setLength:function(c){return this.normalize().multiplyScalar(c)},
equals:function(c){return 1E-4>this.distanceTo(c)},lerp:function(c,g){return this.set((c.x-this._x)*g+this._x,(c.y-this._y)*g+this._y)},isZero:function(){return 1E-4>this.length()},toString:function(){return this._x+","+this._y},toObject:function(){return{x:this._x,y:this._y}}};Two.Vector.prototype.bind=Two.Vector.prototype.on=function(){this._bound||(Two.Vector.MakeGetterSetter(this,"x",this.x),Two.Vector.MakeGetterSetter(this,"y",this.y),_.extend(this,n),this._bound=!0);Backbone.Events.bind.apply(this,
arguments);return this}})();
(function(){var m=Two.Commands,n=Two.Anchor=function(c,g,l,b,d,k,a){Two.Vector.call(this,c,g);this._broadcast=_.bind(function(){this.trigger(Two.Events.change)},this);Object.defineProperty(this,"command",{get:function(){return this._command},set:function(a){this._command=a;this._command!==m.curve||_.isObject(this.controls)||n.AppendCurveProperties(this);return this.trigger(Two.Events.change)}});this._command=a||m.move;if(!a)return this;n.AppendCurveProperties(this);_.isNumber(l)&&(this.controls.left.x=
l);_.isNumber(b)&&(this.controls.left.y=b);_.isNumber(d)&&(this.controls.right.x=d);_.isNumber(k)&&(this.controls.right.y=k)};_.extend(n,{AppendCurveProperties:function(c){var g=c._x||c.x,l=c._y||c.y;c.controls={left:new Two.Vector(g,l),right:new Two.Vector(g,l)}}});_.extend(n.prototype,Two.Vector.prototype,{listen:function(){_.isObject(this.controls)||n.AppendCurveProperties(this);_.each(this.controls,function(c){c.bind(Two.Events.change,this._broadcast)},this);return this},ignore:function(){_.each(this.controls,
function(c){c.unbind(Two.Events.change,this._broadcast)},this);return this},clone:function(){var c=this.controls;return new Two.Anchor(this.x,this.y,c&&c.left.x,c&&c.left.y,c&&c.right.x,c&&c.right.y,this.command)}})})();
(function(){_.range(6);var m=Math.cos,n=Math.sin,c=Math.tan,g=Two.Matrix=function(c,b,d,k,a,e){this.elements=new Two.Array(9);var h=c;_.isArray(h)||(h=_.toArray(arguments));this.identity().set(h)};_.extend(g,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(c,b){if(3>=b.length){var d=b[0]||0,k=b[1]||0,a=b[2]||0;return{x:c[0]*d+c[1]*k+c[2]*a,y:c[3]*d+c[4]*k+c[5]*a,z:c[6]*d+c[7]*k+c[8]*a}}var d=c[0],k=c[1],a=c[2],e=c[3],h=c[4],p=c[5],r=c[6],f=c[7],g=c[8],s=b[0],q=b[1],t=b[2],m=b[3],n=b[4],x=b[5],z=b[6],
D=b[7],A=b[8];return[d*s+k*m+a*z,d*q+k*n+a*D,d*t+k*x+a*A,e*s+h*m+p*z,e*q+h*n+p*D,e*t+h*x+p*A,r*s+f*m+g*z,r*q+f*n+g*D,r*t+f*x+g*A]}});_.extend(g.prototype,Backbone.Events,{set:function(c,b,d,k,a,e){var h=c;_.isArray(h)||(h=_.toArray(arguments));_.each(h,function(a,b){_.isNumber(a)&&(this.elements[b]=a)},this);return this.trigger(Two.Events.change)},identity:function(){this.set(g.Identity);return this},multiply:function(c,b,d,k,a,e,h,p,g){var f=arguments,u=f.length;if(1>=u)return _.each(this.elements,
function(a,b){this.elements[b]=a*c},this),this.trigger(Two.Events.change);if(3>=u)return c=c||0,b=b||0,d=d||0,a=this.elements,{x:a[0]*c+a[1]*b+a[2]*d,y:a[3]*c+a[4]*b+a[5]*d,z:a[6]*c+a[7]*b+a[8]*d};u=this.elements;A0=u[0];A1=u[1];A2=u[2];A3=u[3];A4=u[4];A5=u[5];A6=u[6];A7=u[7];A8=u[8];B0=f[0];B1=f[1];B2=f[2];B3=f[3];B4=f[4];B5=f[5];B6=f[6];B7=f[7];B8=f[8];this.elements[0]=A0*B0+A1*B3+A2*B6;this.elements[1]=A0*B1+A1*B4+A2*B7;this.elements[2]=A0*B2+A1*B5+A2*B8;this.elements[3]=A3*B0+A4*B3+A5*B6;this.elements[4]=
A3*B1+A4*B4+A5*B7;this.elements[5]=A3*B2+A4*B5+A5*B8;this.elements[6]=A6*B0+A7*B3+A8*B6;this.elements[7]=A6*B1+A7*B4+A8*B7;this.elements[8]=A6*B2+A7*B5+A8*B8;return this.trigger(Two.Events.change)},inverse:function(c){var b=this.elements;c=c||new Two.Matrix;var d=b[0],k=b[1],a=b[2],e=b[3],h=b[4],p=b[5],g=b[6],f=b[7],b=b[8],u=b*h-p*f,s=-b*e+p*g,q=f*e-h*g,t=d*u+k*s+a*q;if(!t)return null;t=1/t;c.elements[0]=u*t;c.elements[1]=(-b*k+a*f)*t;c.elements[2]=(p*k-a*h)*t;c.elements[3]=s*t;c.elements[4]=(b*d-
a*g)*t;c.elements[5]=(-p*d+a*e)*t;c.elements[6]=q*t;c.elements[7]=(-f*d+k*g)*t;c.elements[8]=(h*d-k*e)*t;return c},scale:function(c,b){1>=arguments.length&&(b=c);return this.multiply(c,0,0,0,b,0,0,0,1)},rotate:function(c){var b=m(c);c=n(c);return this.multiply(b,-c,0,c,b,0,0,0,1)},translate:function(c,b){return this.multiply(1,0,c,0,1,b,0,0,1)},skewX:function(g){g=c(g);return this.multiply(1,g,0,0,1,0,0,0,1)},skewY:function(g){g=c(g);return this.multiply(1,0,0,g,1,0,0,0,1)},toString:function(){return this.toArray().join(" ")},
toArray:function(c){var b=this.elements,d=parseFloat(b[0].toFixed(3)),k=parseFloat(b[1].toFixed(3)),a=parseFloat(b[2].toFixed(3)),e=parseFloat(b[3].toFixed(3)),h=parseFloat(b[4].toFixed(3)),p=parseFloat(b[5].toFixed(3));if(c){c=parseFloat(b[6].toFixed(3));var g=parseFloat(b[7].toFixed(3)),b=parseFloat(b[8].toFixed(3));return[d,e,c,k,h,g,a,p,b]}return[d,e,k,h,a,p]},clone:function(){return new Two.Matrix(this.elements[0],this.elements[1],this.elements[2],this.elements[3],this.elements[4],this.elements[5],
this.elements[6],this.elements[7],this.elements[8])}})})();
(function(){function m(b){var d={},c=b.id,a=b.translation,e=b.rotation,h=b.scale,p=b.stroke,r=b.linewidth,f=b.fill,u=b.opacity,s=b.visible,q=b.cap,t=b.join,m=b.miter,n=b.closed,x=b.vertices;c&&(d.id=l.Identifier+c);a&&_.isNumber(h)&&_.isNumber(e)&&(d.transform="matrix("+b._matrix.toString()+")");p&&(d.stroke=p);f&&(d.fill=f);u&&(d["stroke-opacity"]=d["fill-opacity"]=u);d.visibility=s?"visible":"hidden";q&&(d["stroke-linecap"]=q);t&&(d["stroke-linejoin"]=t);m&&(d["stroke-miterlimit"]=m);r&&(d["stroke-width"]=
r);x&&(d.d=g.toString(x,n));return d}function n(b,d,c,a){switch(d){case "matrix":d="transform";c="matrix("+c.toString()+")";break;case "visible":d="visibility";c=c?"visible":"hidden";break;case "cap":d="stroke-linecap";break;case "join":d="stroke-linejoin";break;case "miter":d="stroke-miterlimit";break;case "linewidth":d="stroke-width";break;case "vertices":d="d";c=g.toString(c,a);break;case "opacity":g.setAttributes(b,{"stroke-opacity":c,"fill-opacity":c});return}b.setAttribute(d,c)}var c=Two.Utils.mod,
g={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(b,d){var c=document.createElementNS(this.ns,b);"svg"===b&&(d=_.defaults(d||{},{version:this.version}));_.isObject(d)&&this.setAttributes(c,d);return c},setAttributes:function(b,d){_.each(d,function(b,a){this.setAttribute(a,b)},b);return this},removeAttributes:function(b,d){_.each(d,function(b){this.removeAttribute(b)},b);return this},toString:function(b,d){var g=b.length,a=g-1;return _.map(b,
function(e,h){var p,r=d?c(h-1,g):Math.max(h-1,0),f=d?c(h+1,g):Math.min(h+1,a),r=b[r],f=b[f],l,s,q,t,m;m=e.x.toFixed(3);t=e.y.toFixed(3);switch(e._command){case Two.Commands.close:p=e._command;break;case Two.Commands.curve:l=r.controls&&r.controls.right||r;p=e.controls&&e.controls.left||e;r=l.x.toFixed(3);l=l.y.toFixed(3);s=p.x.toFixed(3);q=p.y.toFixed(3);p=e._command+" "+r+" "+l+" "+s+" "+q+" "+m+" "+t;break;default:p=(e._command||(0===h?Two.Commands.move:Two.Commands.line))+" "+m+" "+t}h>=a&&d&&
(e._command===Two.Commands.curve&&(t=e.controls&&e.controls.right||e,m=f.controls&&f.controls.left||f,r=t.x.toFixed(3),l=t.y.toFixed(3),s=m.x.toFixed(3),q=m.y.toFixed(3),m=f.x.toFixed(3),t=f.y.toFixed(3),p+=" C "+r+" "+l+" "+s+" "+q+" "+m+" "+t),p+=" Z");return p}).join(" ")}},l=Two[Two.Types.svg]=function(b){this.count=0;this.domElement=b.domElement||g.createElement("svg");this.elements=[];this.domElement.style.visibility="hidden";this.unveil=_.once(_.bind(function(){this.domElement.style.visibility=
"visible"},this))};_.extend(l,{Identifier:"two-",Utils:g});_.extend(l.prototype,Backbone.Events,{setSize:function(b,d){this.width=b;this.height=d;g.setAttributes(this.domElement,{width:b,height:d});return this},add:function(b){var d=b,c=this.elements,a=this.domElement;_.isArray(b)||(d=_.map(arguments,function(a){return a}));_.each(d,function(b){var d;d=b instanceof Two.Group;if(_.isUndefined(b.id)){var p=this.count;this.count++;b.id=p}d?(d="g",_.isUndefined(b.parent)&&(b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,
_.bind(this.update,this))),b=m(b),delete b.stroke,delete b.fill,delete b["fill-opacity"],delete b["stroke-opacity"],delete b["stroke-linecap"],delete b["stroke-linejoin"],delete b["stroke-miterlimit"],delete b["stroke-width"]):(d="path",b=m(b));b=g.createElement(d,b);a.appendChild(b);c.push(b)},this);return this},update:function(b,d,c,a){var e=this.elements,h=e[b];switch(d){case Two.Properties.hierarchy:_.each(c,function(a){h.appendChild(e[a])});break;case Two.Properties.demotion:_.each(c,function(a){h.removeChild(e[a])});
break;default:n(h,d,c,a)}return this},render:function(){this.unveil();return this}})})();
(function(){var m=Two.Utils.mod,n=function(b){_.each(b,function(b,c){this[c]=b},this);this.children=[]};_.extend(n.prototype,{appendChild:function(b){var d=b.parent;_.isUndefined(d)||d.removeChild(b);this.children.push(b);b.parent=this;return this},removeChild:function(b){b=_.indexOf(this.children,b);return 0>b?this:this.children.splice(b,1)[0]},render:function(b){var d=this.matrix;b.save();b.transform(d[0],d[1],d[2],d[3],d[4],d[5]);_.each(this.children,function(d){d.render(b)});b.restore();return this}});
var c=function(b){_.each(b,function(b,c){this[c]=b},this)};_.extend(c.prototype,{render:function(b){var d=this.matrix,c=this.stroke,a=this.linewidth,e=this.fill,h=this.opacity,g=this.cap,r=this.join,f=this.miter,l=this.closed,s=this.commands,q=s.length,t=q-1;if(!this.visible)return this;b.save();d&&b.transform(d[0],d[1],d[2],d[3],d[4],d[5]);e&&(b.fillStyle=e);c&&(b.strokeStyle=c);a&&(b.lineWidth=a);f&&(b.miterLimit=f);r&&(b.lineJoin=r);g&&(b.lineCap=g);_.isNumber(h)&&(b.globalAlpha=h);b.beginPath();
_.each(s,function(a,e){var d,c,f,h,g,p,k;k=a.x.toFixed(3);p=a.y.toFixed(3);switch(a._command){case Two.Commands.close:b.closePath();break;case Two.Commands.curve:c=l?m(e-1,q):Math.max(e-1,0);d=l?m(e+1,q):Math.min(e+1,t);c=s[c];d=s[d];f=c.controls&&c.controls.right||c;h=a.controls&&a.controls.left||a;c=f.x.toFixed(3);g=f.y.toFixed(3);f=h.x.toFixed(3);h=h.y.toFixed(3);b.bezierCurveTo(c,g,f,h,k,p);e>=t&&l&&(p=a.controls&&a.controls.right||a,k=d.controls&&d.controls.left||d,c=p.x.toFixed(3),g=p.y.toFixed(3),
f=k.x.toFixed(3),h=k.y.toFixed(3),k=d.x.toFixed(3),p=d.y.toFixed(3),b.bezierCurveTo(c,g,f,h,k,p));break;case Two.Commands.line:b.lineTo(k,p);break;case Two.Commands.move:b.moveTo(k,p)}});l&&b.closePath();b.fill();b.stroke();b.restore()}});var g={devicePixelRatio:this.devicePixelRatio||1,getBackingStoreRatio:function(b){return b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1},getRatio:function(b){return this.devicePixelRatio/
this.getBackingStoreRatio(b)}},l=Two[Two.Types.canvas]=function(b){this.count=0;this.domElement=b.domElement||document.createElement("canvas");this.ctx=this.domElement.getContext("2d");this.overdraw=!1;this.elements=[];this.stage=null};_.extend(l,{Group:n,Element:c,getStyles:function(b){var d={},c=b.id,a=b._matrix,e=b.stroke,h=b.linewidth,g=b.fill,r=b.opacity,f=b.visible,l=b.cap,s=b.join,q=b.miter,m=b.closed;b=b.vertices;c&&(d.id=c);_.isObject(a)&&(d.matrix=a.toArray());e&&(d.stroke=e);g&&(d.fill=
g);_.isNumber(r)&&(d.opacity=r);l&&(d.cap=l);s&&(d.join=s);q&&(d.miter=q);h&&(d.linewidth=h);b&&(d.commands=b);d.visible=!!f;d.closed=!!m;return d},setStyles:function(b,d,c,a){switch(d){case "matrix":d="matrix";c=c.toArray();break;case "vertices":d="commands",b.closed=a}b[d]=c},Utils:g});_.extend(l.prototype,Backbone.Events,{setSize:function(b,c,k){this.width=b;this.height=c;this.ratio=_.isUndefined(k)?g.getRatio(this.ctx):k;this.domElement.width=b*this.ratio;this.domElement.height=c*this.ratio;_.extend(this.domElement.style,
{width:b+"px",height:c+"px"});return this},add:function(b){constructor=Object.getPrototypeOf(this).constructor;var c=b,g=this.elements,a=constructor.Group,e=constructor.Element,h=constructor.getStyles;_.isArray(b)||(c=_.map(arguments,function(a){return a}));_.each(c,function(b){var c;c=b instanceof Two.Group;var d=_.isNull(this.stage);if(_.isUndefined(b.id)){var l=this.count;this.count++;b.id=l}c?(c=h.call(this,b),delete c.stroke,delete c.fill,delete c.opacity,delete c.cap,delete c.join,delete c.miter,
delete c.linewidth,c=new a(c),d&&(this.stage=c,this.stage.object=b,this.stage.parent=b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this)))):c=new e(h.call(this,b));g.push(c);d||this.stage.appendChild(c)},this);return this},update:function(b,c,g,a,e){var h=Object.getPrototypeOf(this).constructor,p=this.elements,l=p[b];switch(c){case Two.Properties.hierarchy:_.each(g,function(a){l.appendChild(p[a])});break;case Two.Properties.demotion:_.each(g,function(a){l.removeChild(p[a]);
this.elements[a]=null},this);break;default:h.setStyles.call(this,l,c,g,a,e)}return this},render:function(){if(_.isNull(this.stage))return this;var b=1===this.ratio;b||(this.ctx.save(),this.ctx.scale(this.ratio,this.ratio));this.overdraw||this.ctx.clearRect(0,0,this.width,this.height);this.stage.render(this.ctx);b||this.ctx.restore();return this}})})();
(function(){function m(a,b){var c=Math.min(a.top,b.top),d=Math.min(a.left,b.left),g=Math.max(a.right,b.right),f=Math.max(a.bottom,b.bottom);return{top:c,left:d,right:g,bottom:f,width:g-d,height:f-c,centroid:{x:-d,y:-c}}}var n=Two[Two.Types.canvas],c=Two.Matrix.Multiply,g=Two.Utils.mod,l=function(a){n.Group.call(this,a)};_.extend(l.prototype,n.Group.prototype,{appendChild:function(){n.Group.prototype.appendChild.apply(this,arguments);this.updateMatrix();return this},updateTexture:function(a){_.each(this.children,
function(b){b.updateTexture(a)});return this},updateMatrix:function(a){var b=a&&a._matrix||this.parent&&this.parent._matrix;a=a&&a._scale||this.parent&&this.parent._scale;if(!b)return this;this._matrix=c(this.matrix,b);this._scale=this.scale*a;_.each(this.children,function(a){a.updateMatrix(this)},this);return this},render:function(a,b){_.each(this.children,function(c){c.render(a,b)})}});var b=function(a){n.Element.call(this,a)};_.extend(b.prototype,n.Element.prototype,{updateMatrix:function(a){var b=
a&&a._matrix||this.parent&&this.parent._matrix;a=a&&a._scale||this.parent&&this.parent._scale;if(!b)return this;this._matrix=c(this.matrix,b);this._scale=this.scale*a;return this},updateTexture:function(a){d.updateTexture(a,this);return this},render:function(a,b){if(!this.visible||!this.opacity||!this.buffer)return this;a.bindBuffer(a.ARRAY_BUFFER,this.textureCoordsBuffer);a.vertexAttribPointer(b.textureCoords,2,a.FLOAT,!1,0,0);a.bindTexture(a.TEXTURE_2D,this.texture);a.uniformMatrix3fv(b.matrix,
!1,this._matrix);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.vertexAttribPointer(b.position,2,a.FLOAT,!1,0,0);a.drawArrays(a.TRIANGLES,0,6);return this}});var d={canvas:document.createElement("canvas"),uv:new Two.Array([0,0,1,0,0,1,0,1,1,0,1,1]),getBoundingClientRect:function(a,b){var c=Infinity,d=-Infinity,g=Infinity,f=-Infinity;_.each(a,function(a,b){var e=a.x,k=a.y,l,m;l=a.controls;g=Math.min(k,g);c=Math.min(e,c);d=Math.max(e,d);f=Math.max(k,f);a.controls&&(e=l.left,m=l.right,e&&m&&(l=e.x,e=e.y,
k=m.x,m=m.y,l&&e&&k&&m&&(g=Math.min(e,m,g),c=Math.min(l,k,c),d=Math.max(l,k,d),f=Math.max(e,m,f))))});_.isNumber(b)&&(g-=b,c-=b,d+=b,f+=b);return{top:g,left:c,right:d,bottom:f,width:d-c,height:f-g,centroid:{x:-c,y:-g}}},getTriangles:function(a){var b=a.top,c=a.left,d=a.right;a=a.bottom;return new Two.Array([c,b,d,b,c,a,c,a,d,b,d,a])},updateCanvas:function(a){var b=a.commands,c=this.canvas,d=this.ctx,k=a._scale,f=a.stroke,l=a.linewidth*k,m=a.fill,q=a.opacity,n=a.cap,w=a.join,v=a.miter,x=a.closed,z=
b.length,D=z-1;c.width=Math.max(Math.ceil(a.rect.width*k),1);c.height=Math.max(Math.ceil(a.rect.height*k),1);a=a.rect.centroid;var A=a.x*k,E=a.y*k;d.clearRect(0,0,c.width,c.height);m&&(d.fillStyle=m);f&&(d.strokeStyle=f);l&&(d.lineWidth=l);v&&(d.miterLimit=v);w&&(d.lineJoin=w);n&&(d.lineCap=n);_.isNumber(q)&&(d.globalAlpha=q);d.beginPath();_.each(b,function(a,c){var f,h,l,m,q,s,n;n=(a.x*k+A).toFixed(3);s=(a.y*k+E).toFixed(3);switch(a._command){case Two.Commands.close:d.closePath();break;case Two.Commands.curve:h=
x?g(c-1,z):Math.max(c-1,0);f=x?g(c+1,z):Math.min(c+1,D);h=b[h];f=b[f];l=h.controls&&h.controls.right||h;m=a.controls&&a.controls.left||a;h=(l.x*k+A).toFixed(3);q=(l.y*k+E).toFixed(3);l=(m.x*k+A).toFixed(3);m=(m.y*k+E).toFixed(3);d.bezierCurveTo(h,q,l,m,n,s);c>=D&&x&&(s=a.controls&&a.controls.right||a,n=f.controls&&f.controls.left||f,h=(s.x*k+A).toFixed(3),q=(s.y*k+E).toFixed(3),l=(n.x*k+A).toFixed(3),m=(n.y*k+E).toFixed(3),n=(f.x*k+A).toFixed(3),s=(f.y*k+E).toFixed(3),d.bezierCurveTo(h,q,l,m,n,s));
break;case Two.Commands.line:d.lineTo(n,s);break;case Two.Commands.move:d.moveTo(n,s)}});x&&d.closePath();d.fill();d.stroke()},updateTexture:function(a,b){this.updateCanvas(b);b.texture&&a.deleteTexture(b.texture);a.bindBuffer(a.ARRAY_BUFFER,b.textureCoordsBuffer);b.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,b.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,
a.LINEAR);0>=this.canvas.width||0>=this.canvas.height||a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(a,b,c){_.isObject(b.buffer)&&a.deleteBuffer(b.buffer);b.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.buffer);a.enableVertexAttribArray(c.position);a.bufferData(a.ARRAY_BUFFER,b.triangles,a.STATIC_DRAW);_.isObject(b.textureCoordsBuffer)&&a.deleteBuffer(b.textureCoordsBuffer);b.textureCoordsBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.textureCoordsBuffer);
a.enableVertexAttribArray(c.textureCoords);a.bufferData(a.ARRAY_BUFFER,this.uv,a.STATIC_DRAW)},program:{create:function(a,b){var c=a.createProgram();_.each(b,function(b){a.attachShader(c,b)});a.linkProgram(c);if(!a.getProgramParameter(c,a.LINK_STATUS))throw error=a.getProgramInfoLog(c),a.deleteProgram(c),new Two.Utils.Error("unable to link program: "+error);return c}},shaders:{create:function(a,b,c){c=a.createShader(a[c]);a.shaderSource(c,b);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))throw b=
a.getShaderInfoLog(c),a.deleteShader(c),new Two.Utils.Error("unable to compile shader "+c+": "+b);return c},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:"attribute vec2 a_position;\nattribute vec2 a_textureCoords;\n\nuniform mat3 u_matrix;\nuniform vec2 u_resolution;\n\nvarying vec2 v_textureCoords;\n\nvoid main() {\n   vec2 projected = (u_matrix * vec3(a_position, 1.0)).xy;\n   vec2 normal = projected / u_resolution;\n   vec2 clipspace = (normal * 2.0) - 1.0;\n\n   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);\n   v_textureCoords = a_textureCoords;\n}",
fragment:"precision mediump float;\n\nuniform sampler2D u_image;\nvarying vec2 v_textureCoords;\n\nvoid main() {\n  gl_FragColor = texture2D(u_image, v_textureCoords);\n}"}};d.ctx=d.canvas.getContext("2d");var k=Two[Two.Types.webgl]=function(a){this.count=0;this.domElement=a.domElement||document.createElement("canvas");this.elements=[];this.stage=null;this._matrix=[1,0,0,0,1,0,0,0,1];this._scale=1;a=_.defaults(a||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!0,
overdraw:!1});this.overdraw=a.overdraw;a=this.ctx=this.domElement.getContext("webgl",a)||this.domElement.getContext("experimental-webgl",a);if(!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");var b=d.shaders.create(a,d.shaders.vertex,d.shaders.types.vertex),c=d.shaders.create(a,d.shaders.fragment,d.shaders.types.fragment);this.program=d.program.create(a,[b,c]);a.useProgram(this.program);this.program.position=a.getAttribLocation(this.program,"a_position");
this.program.matrix=a.getUniformLocation(this.program,"u_matrix");this.program.textureCoords=a.getAttribLocation(this.program,"a_textureCoords");a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)};_.extend(k,{Group:l,Element:b,getStyles:function(a){var c={},g=a.id,k=a._matrix,l=a.stroke,f=a.linewidth,m=a.fill,s=a.opacity,q=a.visible,n=a.cap,w=a.join,v=a.miter,x=a.closed,z=a.vertices;
g&&(c.id=g);_.isObject(k)&&(c.matrix=c._matrix=k.toArray(!0),c.scale=c._scale=1);l&&(c.stroke=l);m&&(c.fill=m);_.isNumber(s)&&(c.opacity=s);n&&(c.cap=n);w&&(c.join=w);v&&(c.miter=v);f&&(c.linewidth=f);z&&(c.vertices=z,c.commands=c.vertices,c.rect=d.getBoundingClientRect(c.commands,c.linewidth),c.triangles=d.getTriangles(c.rect));c.visible=!!q;c.closed=!!x;a instanceof Two.Polygon&&(d.updateBuffer(this.ctx,c,this.program),b.prototype.updateTexture.call(c,this.ctx));return c},setStyles:function(a,b,
c,g,k){var f=!1;/matrix/.test(b)?(a[b]=c.toArray(!0),_.isNumber(g)&&(f=a.scale!==g,a.scale=g),a.updateMatrix()):/(stroke|fill|opacity|cap|join|miter|linewidth)/.test(b)?(a[b]=c,a.rect=m(d.getBoundingClientRect(a.commands,a.linewidth),a.rect),a.triangles=d.getTriangles(a.rect),d.updateBuffer(this.ctx,a,this.program),f=!0):"vertices"===b?(_.isUndefined(g)||(a.closed=g),k?a.commands=c:(a.vertices=c,a.commands=a.vertices),a.rect=m(d.getBoundingClientRect(a.vertices,a.linewidth),a.rect),a.triangles=d.getTriangles(a.rect),
d.updateBuffer(this.ctx,a,this.program),f=!0):a[b]=c;f&&a.updateTexture(this.ctx)}});_.extend(k.prototype,Backbone.Events,n.prototype,{setSize:function(a,b,c){n.prototype.setSize.apply(this,arguments);a*=this.ratio;b*=this.ratio;this._matrix[0]=this._matrix[4]=this._scale=this.ratio;_.isNull(this.stage)||this.stage.updateMatrix();this.ctx.viewport(0,0,a,b);var d=this.ctx.getUniformLocation(this.program,"u_resolution");this.ctx.uniform2f(d,a,b);return this},render:function(){if(_.isNull(this.stage))return this;
var a=this.ctx;this.overdraw||a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);this.stage.render(a,this.program);return this}})})();
(function(){var m=Two.Shape=function(n){this._matrix=new Two.Matrix;var c=_.debounce(_.bind(function(){var c=this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation);this.trigger(Two.Events.change,this.id,"matrix",c,this.scale)},this),0);this._rotation=0;Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(g){this._rotation=g;c()}});this._scale="scale";Object.defineProperty(this,"scale",{get:function(){return this._scale},
set:function(g){this._scale=g;c()}});this.translation=new Two.Vector;this.rotation=0;this.scale=1;this.translation.bind(Two.Events.change,c);if(n)return this;m.MakeGetterSetter(this,m.Properties);this.fill="#fff";this.stroke="#000";this.opacity=this.linewidth=1;this.visible=!0;this.join=this.cap="round";this.miter=4};_.extend(m,{Properties:"fill stroke linewidth opacity visible cap join miter".split(" "),MakeGetterSetter:function(m,c){_.isArray(c)||(c=[c]);_.each(c,function(c){var l="_"+c;Object.defineProperty(m,
c,{get:function(){return this[l]},set:function(b){this[l]=b;this.trigger(Two.Events.change,this.id,c,b,this)}})})}});_.extend(m.prototype,Backbone.Events,{addTo:function(m){m.add(this);return this},noFill:function(){this.fill="transparent";return this},noStroke:function(){this.stroke="transparent";return this},clone:function(){var n=new m;n.translation.copy(this.translation);_.each(m.Properties,function(c){n[c]=this[c]},this);return this}})})();
(function(){var m=Math.min,n=Math.max,c=Two.Group=function(g){Two.Shape.call(this,!0);delete this.stroke;delete this.fill;delete this.linewidth;delete this.opacity;delete this.cap;delete this.join;delete this.miter;c.MakeGetterSetter(this,Two.Shape.Properties);this.children={}};_.extend(c,{MakeGetterSetter:function(c,l){_.isArray(l)||(l=[l]);_.each(l,function(b){var d="_"+b;Object.defineProperty(c,b,{get:function(){return this[d]},set:function(c){this[d]=c;_.each(this.children,function(a){a[b]=c})}})})}});
_.extend(c.prototype,Two.Shape.prototype,{clone:function(g){g=g||this.parent;var l=_.map(this.children,function(b){return b.clone(g)}),b=new c;g.add(b);b.add(l);b.translation.copy(this.translation);b.rotation=this.rotation;b.scale=this.scale;return b},corner:function(){var c=this.getBoundingClientRect(!0),l={x:c.left,y:c.top};_.each(this.children,function(b){b.translation.subSelf(l)});return this},center:function(){var c=this.getBoundingClientRect(!0);c.centroid={x:c.left+c.width/2,y:c.top+c.height/
2};_.each(this.children,function(l){l.translation.subSelf(c.centroid)});return this},add:function(c){var l=c,b=this.children,d=this.parent,k=[];_.isArray(c)||(l=_.toArray(arguments));var a=_.bind(function(a,b,c,d,f){this.trigger(Two.Events.change,a,b,c,d,f)},this);_.each(l,function(c){if(c){var g=c.id,l=c.parent;_.isUndefined(g)&&(d.add(c),g=c.id);_.isUndefined(b[g])&&(l&&delete l.children[g],b[g]=c,c.parent=this,c.unbind(Two.Events.change).bind(Two.Events.change,a),k.push(g))}},this);0<k.length&&
this.trigger(Two.Events.change,this.id,Two.Properties.hierarchy,k);return this},remove:function(c){var l=c,b=this.children,d=this.parent,k=[];if(0>=arguments.length&&d)return d.remove(this),this;_.isArray(c)||(l=_.toArray(arguments));_.each(l,function(a){var c=a.id;c in b&&(delete b[c],delete a.parent,a.unbind(Two.Events.change),k.push(c))});0<k.length&&this.trigger(Two.Events.change,this.id,Two.Properties.demotion,k);return this},getBoundingClientRect:function(c){var l=Infinity,b=-Infinity,d=Infinity,
k=-Infinity;_.each(this.children,function(a){a=a.getBoundingClientRect(!0);_.isNumber(a.top)&&_.isNumber(a.left)&&_.isNumber(a.right)&&_.isNumber(a.bottom)&&(d=m(a.top,d),l=m(a.left,l),b=n(a.right,b),k=n(a.bottom,k))},this);var a=c?this._matrix:Two.Utils.getComputedMatrix(this);c=a.multiply(l,d,1);var e=a.multiply(b,d,1),h=a.multiply(b,k,1),a=a.multiply(l,k,1),d=m(c.y,e.y,h.y,a.y),l=m(c.x,e.x,h.x,a.x),b=n(c.x,e.x,h.x,a.x),k=n(c.y,e.y,h.y,a.y);return{top:d,left:l,right:b,bottom:k,width:b-l,height:k-
d}},noFill:function(){_.each(this.children,function(c){c.noFill()});return this},noStroke:function(){_.each(this.children,function(c){c.noStroke()});return this},subdivide:function(){_.each(this.children,function(c){c.subdivide()});return this}})})();
(function(){var m=Math.min,n=Math.max,c=Math.round,g=Two.Polygon=function(g,b,d,k){Two.Shape.call(this);this._closed=!!b;this._curved=!!d;this._automatic=!k;var a=0,e=1,h=!1,p=!1,r,f=[],u=_.debounce(_.bind(function(b){var d;this._automatic&&this.plot();if(h||p)for(b=r.length,d=b-1,b=c(a*d),d=c(e*d),f.length=0;b<d+1;b++)f.push(r[b]);this.trigger(Two.Events.change,this.id,"vertices",f,this._closed,h);p=h=!1},this),0);Object.defineProperty(this,"closed",{get:function(){return this._closed},set:function(a){this._closed=
!!a;u()}});Object.defineProperty(this,"curved",{get:function(){return this._curved},set:function(a){this._curved=!!a;u()}});Object.defineProperty(this,"automatic",{get:function(){return this._automatic},set:function(a){if(a!==this._automatic){var b=(this._automatic=!!a)?"ignore":"listen";_.each(this.vertices,function(a){a[b]()},this);u()}}});Object.defineProperty(this,"beginning",{get:function(){return a},set:function(b){a=m(n(b,0),1);h=!0;u()}});Object.defineProperty(this,"ending",{get:function(){return e},
set:function(a){e=m(n(a,0),1);h=!0;u()}});Object.defineProperty(this,"vertices",{get:function(){return r},set:function(a){var b=_.bind(function(a){_.each(a,function(a){a.bind(Two.Events.change,u)},this);p=!0;u()},this),c=_.bind(function(a){_.each(a,function(a){a.unbind(Two.Events.change,u)},this);p=!0;u()},this);r&&r.unbind();r=new Two.Utils.Collection(a.slice(0));r.bind(Two.Events.insert,b);r.bind(Two.Events.remove,c);p=!0;b(r)}});this.vertices=g;if(this._automatic)return this.plot(),this;_.each(this.vertices,
function(a){_.isFunction(a.listen)&&a.listen()})};_.extend(g.prototype,Two.Shape.prototype,{clone:function(){var c=_.map(this.vertices,function(b){return b.clone()}),b=new g(c,this._closed,this._curved);_.each(Two.Shape.Properties,function(c){b[c]=this[c]},this);b.translation.copy(this.translation);b.rotation=this.rotation;b.scale=this.scale;return b},corner:function(){var c=this.getBoundingClientRect(!0),b={x:c.left,y:c.top};_.each(this.vertices,function(c){c.subSelf(b)});return this},center:function(){var c=
this.getBoundingClientRect(!0);c.centroid={x:c.left+c.width/2,y:c.top+c.height/2};_.each(this.vertices,function(b){b.subSelf(c.centroid)});return this},remove:function(){if(!this.parent)return this;this.parent.remove(this);return this},getBoundingClientRect:function(c){var b=this.linewidth/2,d=Infinity,g=-Infinity,a=Infinity,e=-Infinity;_.each(this.vertices,function(b){var c=b.x;b=b.y;a=m(b,a);d=m(c,d);g=n(c,g);e=n(b,e)});var a=a-b,d=d-b,g=g+b,e=e+b,h=c?this._matrix:Two.Utils.getComputedMatrix(this);
c=h.multiply(d,a,1);var b=h.multiply(g,a,1),p=h.multiply(g,e,1),h=h.multiply(d,e,1),a=m(c.y,b.y,p.y,h.y),d=m(c.x,b.x,p.x,h.x),g=n(c.x,b.x,p.x,h.x),e=n(c.y,b.y,p.y,h.y);return{top:a,left:d,right:g,bottom:e,width:g-d,height:e-a}},plot:function(){if(this._curved)return Two.Utils.getCurveFromPoints(this.vertices,this._closed),this;_.each(this.vertices,function(c,b){c._command=0===b?Two.Commands.move:Two.Commands.line},this);return this},subdivide:function(){var c=this.vertices.length-1,b=this._closed||
this.vertices[c].command===Two.Commands.close,d=[],g;_.each(this.vertices,function(a,c){var h,l,m,f,n,s,q,t;0>=c&&!b||(h=g.x,l=g.y,m=(g.controls&&g.controls.right||g).x,f=(g.controls&&g.controls.right||g).y,n=(a.controls&&a.controls.left||a).x,s=(a.controls&&a.controls.left||a).y,q=a.x,t=a.y,d.push(Two.Utils.subdivide(h,l,m,f,n,s,q,t)));g=a},this);this._curved=this._manual=!1;this.vertices=_.flatten(d);this.plot();return this}})})();