(function(a){var b="GAMEQUERY__";a.extend({gameQuery:{Animation:function(b){var c={imageURL:"",numberOfFrame:1,delta:0,rate:30,type:0,distance:0,offsetx:0,offsety:0};return b=a.extend(c,b),this.imageURL=b.imageURL,this.numberOfFrame=b.numberOfFrame,this.delta=b.delta,this.rate=b.rate,this.type=b.type,this.distance=b.distance,this.offsetx=b.offsetx,this.offsety=b.offsety,a.gameQuery.resourceManager.addAnimation(this),!0},ANIMATION_VERTICAL:1,ANIMATION_HORIZONTAL:2,ANIMATION_ONCE:4,ANIMATION_CALLBACK:8,ANIMATION_MULTI:16,ANIMATION_PINGPONG:32,GEOMETRY_RECTANGLE:1,GEOMETRY_DISC:2,refreshRate:30,resourceManager:{animations:[],sounds:[],callbacks:[],running:!1,preload:function(){for(var b=this.animations.length-1;b>=0;b--)this.animations[b].domO=new Image,this.animations[b].domO.src=this.animations[b].imageURL;for(var b=this.sounds.length-1;b>=0;b--)this.sounds[b].load();a.gameQuery.resourceManager.waitForResources()},waitForResources:function(){var b=a.gameQuery.loadbar!=undefined;if(b){a(a.gameQuery.loadbar.id).width(0);var c=a.gameQuery.loadbar.width/(this.animations.length+this.sounds.length)}var d=0;for(var e=0;e<this.animations.length;e++)this.animations[e].domO.complete&&d++;var f=0;for(var e=0;e<this.sounds.length;e++){var g=this.sounds[e].ready();g&&f++}if(a.gameQuery.resourceManager.loadCallback){var h=(d+f)/(this.animations.length+this.sounds.length)*100;a.gameQuery.resourceManager.loadCallback(h)}d+f<this.animations.length+this.sounds.length?imgWait=setTimeout(function(){a.gameQuery.resourceManager.waitForResources()},100):(a.gameQuery.scenegraph.children().each(function(){a(this).children().each(arguments.callee),this.gameQuery&&this.gameQuery.animation&&(a(this).css("background-image","url("+this.gameQuery.animation.imageURL+")"),this.gameQuery.animation.type&a.gameQuery.ANIMATION_VERTICAL?a(this).css("background-repeat","repeat-x"):this.gameQuery.animation.type&a.gameQuery.ANIMATION_HORIZONTAL?a(this).css("background-repeat","repeat-y"):a(this).css("background-repeat","no-repeat"))}),a.gameQuery.resourceManager.running=!0,setInterval(function(){a.gameQuery.resourceManager.refresh()},a.gameQuery.refreshRate),a.gameQuery.startCallback&&a.gameQuery.startCallback(),a.gameQuery.scenegraph.css("visibility","visible"))},refreshSprite:function(){if(this.gameQuery!=undefined){var b=this.gameQuery;b.animation&&(b.idleCounter==b.animation.rate-1&&b.playing&&(b.animation.type&a.gameQuery.ANIMATION_ONCE?b.currentFrame<b.animation.numberOfFrame-2?b.currentFrame+=b.frameIncrement:b.currentFrame==b.animation.numberOfFrame-2&&(b.currentFrame+=b.frameIncrement,b.animation.type&a.gameQuery.ANIMATION_CALLBACK&&a.isFunction(b.callback)&&b.callback(this)):(b.animation.type&a.gameQuery.ANIMATION_PINGPONG&&(b.currentFrame==b.animation.numberOfFrame-1&&b.frameIncrement==1?b.frameIncrement=-1:b.currentFrame==0&&b.frameIncrement==-1&&(b.frameIncrement=1)),b.currentFrame=(b.currentFrame+b.frameIncrement)%b.animation.numberOfFrame,b.currentFrame==0&&b.animation.type&a.gameQuery.ANIMATION_CALLBACK&&a.isFunction(b.callback)&&b.callback(this)),b.animation.type&a.gameQuery.ANIMATION_VERTICAL?b.multi?a(this).css("background-position",""+(-b.animation.offsetx-b.multi)+"px "+(-b.animation.offsety-b.animation.delta*b.currentFrame)+"px"):a(this).css("background-position",""+ -b.animation.offsetx+"px "+(-b.animation.offsety-b.animation.delta*b.currentFrame)+"px"):b.animation.type&a.gameQuery.ANIMATION_HORIZONTAL&&(b.multi?a(this).css("background-position",""+(-b.animation.offsetx-b.animation.delta*b.currentFrame)+"px "+(-b.animation.offsety-b.multi)+"px"):a(this).css("background-position",""+(-b.animation.offsetx-b.animation.delta*b.currentFrame)+"px "+ -b.animation.offsety+"px"))),b.idleCounter=(b.idleCounter+1)%b.animation.rate)}return!0},refreshTilemap:function(){if(this.gameQuery!=undefined){var b=this.gameQuery;if(a.isArray(b.frameTracker))for(var c=0;c<b.frameTracker.length;c++)b.idleCounter[c]==b.animations[c].rate-1&&(b.animations[c].type&a.gameQuery.ANIMATION_ONCE?b.frameTracker[c]<b.animations[c].numberOfFrame-1&&(b.frameTracker[c]+=b.frameIncrement[c]):(b.animations[c].type&a.gameQuery.ANIMATION_PINGPONG&&(b.frameTracker[c]==b.animations[c].numberOfFrame-1&&b.frameIncrement[c]==1?b.frameIncrement[c]=-1:b.frameTracker[c]==0&&b.frameIncrement[c]==-1&&(b.frameIncrement[c]=1)),b.frameTracker[c]=(b.frameTracker[c]+b.frameIncrement[c])%b.animations[c].numberOfFrame)),b.idleCounter[c]=(b.idleCounter[c]+1)%b.animations[c].rate;else b.idleCounter==b.animations.rate-1&&(b.animations.type&a.gameQuery.ANIMATION_ONCE?b.frameTracker<b.animations.numberOfFrame-1&&(b.frameTracker+=b.frameIncrement):(b.animations.type&a.gameQuery.ANIMATION_PINGPONG&&(b.frameTracker==b.animations.numberOfFrame-1&&b.frameIncrement==1?b.frameIncrement=-1:b.frameTracker==0&&b.frameIncrement==-1&&(b.frameIncrement=1)),b.frameTracker=(b.frameTracker+b.frameIncrement)%b.animations.numberOfFrame)),b.idleCounter=(b.idleCounter+1)%b.animations.rate;a(this).find(".active").each(function(){if(a.isArray(b.frameTracker)){var c=this.gameQuery.animationNumber;b.animations[c].type&a.gameQuery.ANIMATION_VERTICAL?a(this).css("background-position",""+ -b.animations[c].offsetx+"px "+(-b.animations[c].offsety-b.animations[c].delta*b.frameTracker[c])+"px"):b.animations[c].type&a.gameQuery.ANIMATION_HORIZONTAL&&a(this).css("background-position",""+(-b.animations[c].offsetx-b.animations[c].delta*b.frameTracker[c])+"px "+ -b.animations[c].offsety+"px")}else b.animations.type&a.gameQuery.ANIMATION_VERTICAL?a(this).css("background-position",""+(-b.animations.offsetx-this.gameQuery.multi)+"px "+(-b.animations.offsety-b.animations.delta*b.frameTracker)+"px"):b.animations.type&a.gameQuery.ANIMATION_HORIZONTAL&&a(this).css("background-position",""+(-b.animations.offsetx-b.animations.delta*b.frameTracker)+"px "+(-b.animations.offsety-this.gameQuery.multi)+"px")})}return!0},refresh:function(){a.gameQuery.playground.find(".sprite").each(this.refreshSprite),a.gameQuery.playground.find(".tileSet").each(this.refreshTilemap);var b=new Array;for(var c=this.callbacks.length-1;c>=0;c--){if(this.callbacks[c].idleCounter==this.callbacks[c].rate-1){var d=this.callbacks[c].fn();typeof d=="boolean"?d&&b.push(c):typeof d=="number"&&(this.callbacks[c].rate=Math.round(d/a.gameQuery.refreshRate),this.callbacks[c].idleCounter=0)}this.callbacks[c].idleCounter=(this.callbacks[c].idleCounter+1)%this.callbacks[c].rate}for(var c=b.length-1;c>=0;c--)this.callbacks.splice(b[c],1)},addAnimation:function(b){a.inArray(b,this.animations)<0&&(b.rate=Math.round(b.rate/a.gameQuery.refreshRate),b.rate==0&&(b.rate=1),this.animations.push(b))},addSound:function(b){a.inArray(b,this.sounds)<0&&this.sounds.push(b)},registerCallback:function(b,c){c=Math.round(c/a.gameQuery.refreshRate),c==0&&(c=1),this.callbacks.push({fn:b,rate:c,idleCounter:0})}},update:function(b,c){if(!a.isPlainObject(b))if(b.length>0)var d=b[0].gameQuery;else var d=b.gameQuery;else var d=b;if(!d)return;if(d.tileSet===!0){var e={top:d.posy,left:d.posx},f=b.parent();while(f[0]!==a.gameQuery.playground[0])f[0].gameQuery!==undefined&&(e.left+=f[0].gameQuery.posx,e.top+=f[0].gameQuery.posy),f=a(f).parent();for(property in c)switch(property){case"x":var g=d.posx,h=Math.max(Math.min(Math.floor(-e.left/d.width),d.sizex),0),i=Math.max(Math.min(Math.ceil((a.gameQuery.playground[0].width-e.left)/d.width),d.sizex),0);for(var j=d.firstRow;j<d.lastRow;j++){for(var k=d.firstColumn;k<h;k++)a("#tile_"+b.attr("id")+"_"+j+"_"+k).removeClass("active");for(var k=d.lastColumn;k<i;k++)a("#tile_"+b.attr("id")+"_"+j+"_"+k).addClass("active");for(var k=i;k<d.lastColumn;k++)a("#tile_"+b.attr("id")+"_"+j+"_"+k).removeClass("active");for(var k=h;k<d.firstColumn;k++)a("#tile_"+b.attr("id")+"_"+j+"_"+k).addClass("active")}d.firstColumn=h,d.lastColumn=i;break;case"y":var l=Math.max(Math.min(Math.floor(-e.top/d.height),d.sizey),0),m=Math.max(Math.min(Math.ceil((a.gameQuery.playground[0].height-e.top)/d.height),d.sizey),0);for(var k=d.firstColumn;k<d.lastColumn;k++){for(var j=d.firstRow;j<l;j++)a("#tile_"+b.attr("id")+"_"+j+"_"+k).removeClass("active");for(var j=d.lastRow;j<m;j++)a("#tile_"+b.attr("id")+"_"+j+"_"+k).addClass("active");for(var j=m;j<d.lastRow;j++)a("#tile_"+b.attr("id")+"_"+j+"_"+k).removeClass("active");for(var j=l;j<d.firstRow;j++)a("#tile_"+b.attr("id")+"_"+j+"_"+k).addClass("active")}d.firstRow=l,d.lastRow=m;break;case"angle":break;case"factor":}}else{var n=a.gameQuery.playground&&!a.gameQuery.playground.disableCollision;for(property in c)switch(property){case"x":n&&(d.boundingCircle.x=d.posx+d.width/2);break;case"y":n&&(d.boundingCircle.y=d.posy+d.height/2);break;case"w":case"h":d.boundingCircle.originalRadius=Math.sqrt(Math.pow(d.width,2)+Math.pow(d.height,2))/2,d.boundingCircle.radius=d.factor*d.boundingCircle.originalRadius;break;case"angle":d.angle=parseFloat(c.angle);break;case"factor":d.factor=parseFloat(c.factor),n&&(d.boundingCircle.radius=d.factor*d.boundingCircle.originalRadius)}}},proj:function(b,c){switch(b.geometry){case a.gameQuery.GEOMETRY_RECTANGLE:var d=c*Math.PI*2/360,e=Math.abs(Math.cos(d)*b.width/2*b.factor)+Math.abs(Math.sin(d)*b.height/2*b.factor),f=Math.abs(Math.cos(d)*b.height/2*b.factor)+Math.abs(Math.sin(d)*b.width/2*b.factor);return{x:e,y:f}}},collide:function(b,c,d,e){if(b.geometry==a.gameQuery.GEOMETRY_RECTANGLE&&d.geometry==a.gameQuery.GEOMETRY_RECTANGLE){var f=e.x+d.boundingCircle.x-b.boundingCircle.x-c.x,g=e.y+d.boundingCircle.y-b.boundingCircle.y-c.y,h=Math.atan(g/f),i=Math.abs(Math.cos(h-b.angle*Math.PI*2/360)/Math.cos(h)*f),j=Math.abs(Math.sin(h-b.angle*Math.PI*2/360)/Math.sin(h)*g),k=a.gameQuery.proj(d,d.angle-b.angle);if(b.width/2*b.factor+k.x<=i||b.height/2*b.factor+k.y<=j)return!1;var i=Math.abs(Math.cos(h-d.angle*Math.PI*2/360)/Math.cos(h)*-f),j=Math.abs(Math.sin(h-d.angle*Math.PI*2/360)/Math.sin(h)*-g),k=a.gameQuery.proj(b,b.angle-d.angle);return d.width/2*d.factor+k.x<=i||d.height/2*d.factor+k.y<=j?!1:!0}return!1}},muteSound:function(b){for(var c=a.gameQuery.resourceManager.sounds.length-1;c>=0;c--)a.gameQuery.resourceManager.sounds[c].muted(b)},playground:function(){return a.gameQuery.playground},loadCallback:function(b){a.gameQuery.resourceManager.loadCallback=b}}),a.fn.extend({playground:function(b){if(this.length==1){if(this[0]==document)throw"Old playground usage, use $.playground() to retreive the playground and $('mydiv').playground(options) to set the div!";b=a.extend({height:320,width:480,refreshRate:30,position:"absolute",keyTracker:!1,disableCollision:!1},b),a.gameQuery.playground=this,a.gameQuery.refreshRate=b.refreshRate,a.gameQuery.playground[0].height=b.height,a.gameQuery.playground[0].width=b.width,a.gameQuery.playground.css({position:b.position,display:"block",overflow:"hidden",height:b.height+"px",width:b.width+"px"}).append("<div id='scenegraph' style='visibility: hidden'/>"),a.gameQuery.scenegraph=a("#scenegraph"),a.gameQuery.keyTracker={},b.keyTracker&&(a(document).keydown(function(b){a.gameQuery.keyTracker[b.keyCode]=!0}),a(document).keyup(function(b){a.gameQuery.keyTracker[b.keyCode]=!1}))}return this},startGame:function(b){return a.gameQuery.startCallback=b,a.gameQuery.resourceManager.preload(),this},addGroup:function(b,c){c=a.extend({width:32,height:32,posx:0,posy:0,posz:0,posOffsetX:0,posOffsetY:0,overflow:"visible",geometry:a.gameQuery.GEOMETRY_RECTANGLE,angle:0,factor:1,factorh:1,factorv:1},c);var d="<div id='"+b+"' class='group' style='position: absolute; display: block; overflow: "+c.overflow+"; top: "+c.posy+"px; left: "+c.posx+"px; height: "+c.height+"px; width: "+c.width+"px;' />";this==a.gameQuery.playground?a.gameQuery.scenegraph.append(d):(this==a.gameQuery.scenegraph||this.hasClass("group"))&&this.append(d);var e=a("#"+b);return e[0].gameQuery=c,e[0].gameQuery.boundingCircle={x:c.posx+c.width/2,y:c.posy+c.height/0,originalRadius:Math.sqrt(Math.pow(c.width,2)+Math.pow(c.height,2))/2},e[0].gameQuery.boundingCircle.radius=e[0].gameQuery.boundingCircle.originalRadius,e[0].gameQuery.group=!0,this.pushStack(e)},addSprite:function(b,c){c=a.extend({width:32,height:32,posx:0,posy:0,posz:0,posOffsetX:0,posOffsetY:0,idleCounter:0,currentFrame:0,frameIncrement:1,geometry:a.gameQuery.GEOMETRY_RECTANGLE,angle:0,factor:1,playing:!0,factorh:1,factorv:1},c);var d="<div id='"+b+"' class='sprite' style='position: absolute; display: block; overflow: hidden; height: "+c.height+"px; width: "+c.width+"px; left: "+c.posx+"px; top: "+c.posy+"px; background-position: "+(c.animation?-c.animation.offsetx:0)+"px "+(c.animation?-c.animation.offsety:0)+"px;' />";this==a.gameQuery.playground?a.gameQuery.scenegraph.append(d):this.append(d),c.animation&&(a.gameQuery.resourceManager.running&&c.animation.imageURL!==""&&a("#"+b).css("background-image","url("+c.animation.imageURL+")"),c.animation.type&a.gameQuery.ANIMATION_VERTICAL?a("#"+b).css("background-repeat","repeat-x"):c.animation.type&a.gameQuery.ANIMATION_HORIZONTAL?a("#"+b).css("background-repeat","repeat-y"):a("#"+b).css("background-repeat","no-repeat"));var e=a("#"+b)[0];return e!=undefined&&(e.gameQuery=c,e.gameQuery.boundingCircle={x:c.posx+c.width/2,y:c.posy+c.height/2,originalRadius:Math.sqrt(Math.pow(c.width,2)+Math.pow(c.height,2))/2},e.gameQuery.boundingCircle.radius=e.gameQuery.boundingCircle.originalRadius),this},removeSprite:function(){return this.remove(),this},addTilemap:function(b,c,d,e){e=a.extend({width:32,height:32,sizex:32,sizey:32,posx:0,posy:0,posz:0,posOffsetX:0,posOffsetY:0,factorh:1,factorv:1},e);var f=a("<div class='tileSet' style='position: absolute; display: block; overflow: hidden;' />");f.css({top:e.posy,left:e.posx,height:e.height*e.sizey,width:e.width*e.sizex}).attr("id",b),this==a.gameQuery.playground?a.gameQuery.scenegraph.append(f):this.append(f);if(a.isArray(d)){var g=[],h=[],i=[];for(var j=0;j<d.length;j++)g[j]=0,h[j]=0,i[j]=1;f[0].gameQuery=e,f[0].gameQuery.frameTracker=g,f[0].gameQuery.animations=d,f[0].gameQuery.idleCounter=h,f[0].gameQuery.frameIncrement=i,f[0].gameQuery.tileSet=!0}else f[0].gameQuery=e,f[0].gameQuery.frameTracker=0,f[0].gameQuery.frameIncrement=1,f[0].gameQuery.animations=d,f[0].gameQuery.idleCounter=0,f[0].gameQuery.tileSet=!0;if(typeof c=="function"){for(var j=0;j<e.sizey;j++)for(var k=0;k<e.sizex;k++)if(c(j,k)!=0)if(a.isArray(d)){f.addSprite("tile_"+b+"_"+j+"_"+k,{width:e.width,height:e.height,posx:k*e.width,posy:j*e.height,animation:d[c(j,k)-1]});var l=a("#tile_"+b+"_"+j+"_"+k);l.removeClass("sprite"),l.addClass("tileType_"+(c(j,k)-1)),l[0].gameQuery.animationNumber=c(j,k)-1}else{f.addSprite("tile_"+b+"_"+j+"_"+k,{width:e.width,height:e.height,posx:k*e.width,posy:j*e.height,animation:d});var l=a("#tile_"+b+"_"+j+"_"+k);l.setAnimation(c(j,k)-1),l.removeClass("sprite"),l.addClass("tileType_"+(c(j,k)-1))}}else if(typeof c=="object")for(var j=0;j<c.length;j++)for(var k=0;k<c[0].length;k++)if(c[j][k]!=0)if(a.isArray(d)){f.addSprite("tile_"+b+"_"+j+"_"+k,{width:e.width,height:e.height,posx:k*e.width,posy:j*e.height,animation:d[c[j][k]-1]});var l=a("#tile_"+b+"_"+j+"_"+k);l.removeClass("sprite"),l.addClass("tileType_"+(c[j][k]-1)),l[0].gameQuery.animationNumber=c[j][k]-1}else{f.addSprite("tile_"+b+"_"+j+"_"+k,{width:e.width,height:e.height,posx:k*e.width,posy:j*e.height,animation:d});var l=a("#tile_"+b+"_"+j+"_"+k);l.setAnimation(c[j][k]-1),l.removeClass("sprite"),l.removeClass("active"),l.addClass("tileType_"+(c[j][k]-1))}var m={top:e.posy,left:e.posx},n=this;while(n[0]!==a.gameQuery.playground[0])n[0].gameQuery!==undefined&&(m.left+=n[0].gameQuery.posx,m.top+=n[0].gameQuery.posy),n=a(n).parent();var o=Math.max(Math.min(Math.floor(-m.top/e.height),e.sizey),0),p=Math.max(Math.min(Math.ceil((a.gameQuery.playground[0].height-m.top)/e.height),e.sizey),0),q=Math.max(Math.min(Math.floor(-m.left/e.width),e.sizex),0),r=Math.max(Math.min(Math.ceil((a.gameQuery.playground[0].width-m.left)/e.width),e.sizex),0);f[0].gameQuery.firstRow=o,f[0].gameQuery.lastRow=p,f[0].gameQuery.firstColumn=q,f[0].gameQuery.lastColumn=r;for(var j=o;j<p;j++)for(var k=q;k<r;k++)a("#tile_"+b+"_"+j+"_"+k).toggleClass("active");return this.pushStack(f)},pauseAnimation:function(){return this[0].gameQuery.playing=!1,this},resumeAnimation:function(){return this[0].gameQuery.playing=!0,this},setAnimation:function(b,c){var d=this[0].gameQuery;if(typeof b=="number"){if(d.animation.type&a.gameQuery.ANIMATION_MULTI){var e=d.animation.distance*b;d.multi=e,d.frameIncrement=1,d.currentFrame=0,d.animation.type&a.gameQuery.ANIMATION_VERTICAL?this.css("background-position",""+(-e-d.animation.offsetx)+"px "+ -d.animation.offsety+"px"):d.animation.type&a.gameQuery.ANIMATION_HORIZONTAL&&this.css("background-position",""+ -d.animation.offsetx+"px "+(-e-d.animation.offsety)+"px")}}else b?(d.animation=b,d.currentFrame=0,d.frameIncrement=1,b.imageURL!==""&&this.css("backgroundImage","url('"+b.imageURL+"')"),this.css({"background-position":""+ -b.offsetx+"px "+ -b.offsety+"px"}),d.animation.type&a.gameQuery.ANIMATION_VERTICAL?this.css("background-repeat","repeat-x"):d.animation.type&a.gameQuery.ANIMATION_HORIZONTAL?this.css("background-repeat","repeat-y"):this.css("background-repeat","no-repeat")):this.css("background-image","");return c!=undefined&&(this[0].gameQuery.callback=c),this},registerCallback:function(b,c){return a.gameQuery.resourceManager.registerCallback(b,c),this},collision:function(b){var c=[],d=this[0].parentNode,e=0,f=0;while(d!=a.gameQuery.playground[0])d.gameQuery&&(e+=d.gameQuery.posx,f+=d.gameQuery.posy),d=d.parentNode;var g=this[0].gameQuery,h={top:0,left:0,bottom:a.playground().height(),right:a.playground().width()};if(g.boundingCircle.y+g.boundingCircle.radius+f<h.top||g.boundingCircle.x+g.boundingCircle.radius+e<h.left||g.boundingCircle.y-g.boundingCircle.radius+f>h.bottom||g.boundingCircle.x-g.boundingCircle.radius+e>h.right)return this.pushStack(new a([]));if(this!=a.gameQuery.playground){var i=new Array;i.push(a.gameQuery.scenegraph.children(b).get()),i[0].offsetX=0,i[0].offsetY=0;for(var j=0,k=i.length;j<k;j++){var l=i[j].length;while(l--){var m=i[j][l];if(m.gameQuery){if(!m.gameQuery.group&&!m.gameQuery.tileSet&&this[0]!=m){var n=Math.sqrt(Math.pow(f+g.boundingCircle.y-i[j].offsetY-m.gameQuery.boundingCircle.y,2)+Math.pow(e+g.boundingCircle.x-i[j].offsetX-m.gameQuery.boundingCircle.x,2));n-g.boundingCircle.radius-m.gameQuery.boundingCircle.radius<=0&&a.gameQuery.collide(g,{x:e,y:f},m.gameQuery,{x:i[j].offsetX,y:i[j].offsetY})&&c.push(i[j][l])}var o=a(m).children(b);o.length&&(i.push(o.get()),i[k].offsetX=m.gameQuery.posx+i[j].offsetX,i[k].offsetY=m.gameQuery.posy+i[j].offsetY,k++)}}}return this.pushStack(a(c))}},addSound:function(b,c){if(a.gameQuery.SoundWrapper){var d=this[0].gameQuery;if(c){var e=d.sounds;e?e.push(b):d.sounds=[b]}else d.sounds=[b]}return this},playSound:function(){return a(this).each(function(){var a=this.gameQuery;if(a.sounds)for(var b=a.sounds.length-1;b>=0;b--)a.sounds[b].play()}),this},stopSound:function(){return a(this).each(function(){var a=this.gameQuery;if(a.sounds)for(var b=a.sounds.length-1;b>=0;b--)a.sounds[b].stop()}),this},pauseSound:function(){return a(this).each(function(){var a=this.gameQuery;if(a.sounds)for(var b=a.sounds.length-1;b>=0;b--)a.sounds[b].pause()}),this},muteSound:function(b){a(this).each(function(){var a=this.gameQuery;if(a.sounds)for(var c=a.sounds.length-1;c>=0;c--)a.sounds[c].muted(b)})},transform:function(b,c){var d=this[0].gameQuery;a.gameQuery.update(d,{angle:b,factor:c});if(this.css("MozTransform")){var e="rotate("+b+"deg) scale("+c*d.factorh+","+c*d.factorv+")";this.css("MozTransform",e)}else if(this.css("-o-transform")){var e="rotate("+b+"deg) scale("+c*d.factorh+","+c*d.factorv+")";this.css("-o-transform",e)}else if(this.css("msTransform")!==null&&this.css("msTransform")!==undefined){var e="rotate("+b+"deg) scale("+c*d.factorh+","+c*d.factorv+")";this.css("msTransform",e)}else if(this.css("WebkitTransform")!==null&&this.css("WebkitTransform")!==undefined){var e="rotate("+b+"deg) scale("+c*d.factorh+","+c*d.factorv+")";this.css("WebkitTransform",e)}else if(this.css("filter")!==undefined){var f=Math.PI*2/360*b,g=Math.cos(f)*c,h=Math.sin(f)*c;this.css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+g*d.factorh+",M12="+ -h*d.factorv+",M21="+h*d.factorh+",M22="+g*d.factorv+",SizingMethod='auto expand',FilterType='nearest neighbor')");var i=this.width(),j=this.height();d.posOffsetX=(i-d.width)/2,d.posOffsetY=(j-d.height)/2,this.css("left",""+(d.posx-d.posOffsetX)+"px"),this.css("top",""+(d.posy-d.posOffsetY)+"px")}return this},rotate:function(a){var b=this[0].gameQuery;if(a!==undefined)return this.transform(a%360,this.scale());var c=b.angle;return c?c:0},scale:function(a){var b=this[0].gameQuery;if(a!==undefined)return this.transform(this.rotate(),a);var c=b.factor;return c?c:1},fliph:function(a){var b=this[0].gameQuery;return a===undefined?b.factorh*=-1:a?b.factorh=-1:b.factorh=1,this.transform(this.rotate(),this.scale())},flipv:function(a){var b=this[0].gameQuery;return a===undefined?b.factorv*=-1:a?b.factorv=-1:b.factorv=1,this.transform(this.rotate(),this.scale())},xyz:function(a,b,c,d){return a===undefined?this.getxyz():this.setxyz({x:a,y:b,z:c},d)},x:function(a,b){return a===undefined?this.getxyz().x:this.setxyz({x:a},b)},y:function(a,b){return a===undefined?this.getxyz().y:this.setxyz({y:a},b)},z:function(a,b){return a===undefined?this.getxyz().z:this.setxyz({z:a},b)},xy:function(a,b,c){return a===undefined?this.getxyz():this.setxyz({x:a,y:b},c)},wh:function(a,b,c){return a===undefined?this.getwh():this.setwh({w:a,h:b},c)},w:function(a,b){return a===undefined?this.getwh().w:this.setwh({w:a},b)},h:function(a,b){return a===undefined?this.getwh().h:this.setwh({h:a},b)},getxyz:function(){var a=this[0].gameQuery;return{x:a.posx,y:a.posy,z:a.posz}},setxyz:function(b,c){var d=this[0].gameQuery;for(coordinate in b)switch(coordinate){case"x":c&&(b.x+=d.posx),d.posx=b.x,this.css("left",""+(d.posx+d.posOffsetX)+"px"),this.find(".tileSet").each(function(){a(this).x(0,!0)});break;case"y":c&&(b.y+=d.posy),d.posy=b.y,this.css("top",""+(d.posy+d.posOffsetY)+"px"),this.find(".tileSet").each(function(){a(this).y(0,!0)});break;case"z":c&&(b.z+=d.posz),d.posz=b.z,this.css("z-index",d.posz)}return a.gameQuery.update(this,b),this},getwh:function(){var a=this[0].gameQuery;return{w:a.width,h:a.height}},setwh:function(b,c){var d=this[0].gameQuery;for(coordinate in b)switch(coordinate){case"w":c&&(b.w+=d.width),d.width=b.w,this.css("width",""+d.width+"px");break;case"h":c&&(b.h+=d.height),d.height=b.h,this.css("height",""+d.height+"px")}return a.gameQuery.update(this,b),this}})})(jQuery)