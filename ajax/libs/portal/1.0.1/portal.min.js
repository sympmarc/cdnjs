/* Portal v1.0.1 | http://github.com/flowersinthesand/portal | (c) 2011-2013, Donghwan Kim | http://www.apache.org/licenses/LICENSE-2.0 */
(function(){function y(a){var c=[],b,d,g,e,l,m,q=function(b,n){n=n||[];d=!a||[b,n];g=!0;m=e||0;e=0;for(l=c.length;m<l;m++)c[m].apply(b,n);g=!1};return{add:function(a){var n=c.length;c.push(a);g?l=c.length:!b&&d&&!0!==d&&(e=n,q(d[0],d[1]))},remove:function(a){var b;for(b=0;b<c.length;b++)if(a===c[b]||a.guid&&a.guid===c[b].guid)g&&b<=l&&(l--,b<=m&&m--),c.splice(b--,1)},fire:function(c,e){b||g||a&&d||q(c,e)},lock:function(){b=!0},locked:function(){return!!b},unlock:function(){b=d=g=e=l=m=void 0}}}function A(a,
c){var b,f,g,e={},l=0,m={},q=[],s,n,p,k={},t=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/.exec(a.toLowerCase()),h={option:function(a,c){if(void 0===c)return b[a];b[a]=c;return this},data:function(a,b){if(void 0===b)return k[a];k[a]=b;return this},state:function(){return g},on:function(a,b){var c;if("object"===typeof a){for(c in a)h.on(c,a[c]);return this}c=e[a];if(!c){if(e.message.locked())return this;c=e[a]=y();c.order=e.message.order}c.add(b);return this},off:function(a,b){var c=e[a];c&&c.remove(b);
return this},one:function(a,b){function c(){h.off(a,c);b.apply(h,arguments)}b.guid=b.guid||u++;c.guid=b.guid;return h.on(a,c)},fire:function(a){var b=e[a];b&&b.fire(h,x.call(arguments,1));return this},open:function(){var a,c,l=function(){var a,e;if(!c){c=!0;for(a=k.candidates=x.call(b.transports);!f&&a.length;)e=a.shift(),k.transport=e,k.url=h.buildURL("open"),f=d.transports[e](h,b);p&&p++;f?(h.fire("connecting"),f.open()):h.fire("close","notransport")}},n=function(){c||(c=!0,h.fire("close","canceled"))};
s&&clearTimeout(s);k={};for(a in e)e[a].unlock();f=void 0;g="preparing";b.sharing&&(k.transport="session",f=d.transports.session(h,b));f?l():b.prepare.call(h,l,n,b);return this},send:function(a,c,e,n){var p;if("opened"!==g)return q.push(arguments),this;p={id:++l,socket:b.id,type:a,data:c,reply:!(!e&&!n)};p.reply&&("session"===k.transport?(p.doneCallback=e,p.failCallback=n):m[l]={done:e,fail:n});f.send(d.support.isBinary(c)?c:b.outbound.call(h,p));return this},close:function(){var a,c;b.reconnect=
!1;s&&clearTimeout(s);!v&&f&&f.feedback||(h.fire("close",v?"error":"aborted"),b.notifyAbort&&"session"!==k.transport&&(c=document.head||document.getElementsByTagName("head")[0]||document.documentElement,a=document.createElement("script"),a.async=!1,a.src=h.buildURL("abort"),a.onload=a.onreadystatechange=function(){if(!a.readyState||/loaded|complete/.test(a.readyState))a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a)},c.insertBefore(a,c.firstChild)));f&&f.close();return this},
broadcast:function(a,b){var c=k.broadcastable;c&&c.broadcast({type:"fire",data:{type:a,data:b}});return this},_fire:function(a,c){var e;if(c){for(a=b.streamParser.call(h,a);a.length;)h._fire(a.shift());return this}d.support.isBinary(a)?e=[{type:"message",data:a}]:(e=b.inbound.call(h,a),e=null==e?[]:d.support.isArray(e)?e:[e]);k.lastEventIds=[];d.support.each(e,function(a,c){var e,d=[c.type,c.data];b.lastEventId=c.id;k.lastEventIds.push(c.id);c.reply&&d.push(function(a){e||(e=!0,h.send("reply",{id:c.id,
data:a}))});h.fire.apply(h,d).fire("_message",d)});return this},buildURL:function(c,e){var f="open"===c?{transport:k.transport,heartbeat:b.heartbeat,lastEventId:b.lastEventId}:"poll"===c?{transport:k.transport,lastEventIds:k.lastEventIds&&k.lastEventIds.join(","),lastEventId:b.lastEventId}:{};d.support.extend(f,{id:b.id,_:u++},b.params&&b.params[c],e);return b.urlBuilder.call(h,a,f,c)}};b=d.support.extend({},d.defaults,c);c&&c.transports&&(b.transports=x.call(c.transports));b.url=a;b.id=b.idGenerator.call(h);
b.crossDomain=!(!t||t[1]==location.protocol&&t[2]==location.hostname&&(t[3]||("http:"===t[1]?80:443))==(location.port||("http:"===location.protocol?80:443)));d.support.each(["connecting","open","message","close","waiting"],function(a,b){e[b]=y("message"!==b);e[b].order=a;var c=h[b],f=function(a){return h.on(b,a)};h[b]=c?function(a){return(d.support.isFunction(a)?f:c).apply(this,arguments)}:f});h.on({connecting:function(){function c(){n=setTimeout(function(){f.close();h.fire("close","timeout")},b.timeout)}
function e(){clearTimeout(n)}function l(){function c(a){a=d.support.parseJSON(a);var b=a.data;if(!a.target)"fire"===a.type&&h.fire(b.type,b.data);else if("p"===a.target)switch(a.type){case "send":h.send(b.type,b.data,b.doneCallback,b.failCallback);break;case "close":h.close()}}function e(a){g.broadcast({target:"c",type:"message",data:a})}function f(){document.cookie=encodeURIComponent(m)+"="+encodeURIComponent(d.support.stringifyJSON({ts:d.support.now()+1,heir:(g.get("children")||[])[0]}))+"; path=/"}
var n,g,m="socket-"+a,q={storage:function(){if(d.support.storage){var a=window.localStorage;return{init:function(){function b(a){a.key===m&&a.newValue&&c(a.newValue)}d.support.on(window,"storage",b);h.one("close",function(){d.support.off(window,"storage",b);h.one("close",function(){a.removeItem(m);a.removeItem(m+"-opened");a.removeItem(m+"-children")})})},broadcast:function(b){var e=d.support.stringifyJSON(b);a.setItem(m,e);setTimeout(function(){c(e)},50)},get:function(b){return d.support.parseJSON(a.getItem(m+
"-"+b))},set:function(b,c){a.setItem(m+"-"+b,d.support.stringifyJSON(c))}}}},windowref:function(){var a=m.replace(/\W/g,""),b=document.getElementById(a),e;b||(b=document.createElement("div"),b.id=a,b.style.display="none",b.innerHTML='<iframe name="'+a+'" />',document.body.appendChild(b));e=b.firstChild.contentWindow;return{init:function(){e.callbacks=[c];e.fire=function(a){var b;for(b=0;b<e.callbacks.length;b++)e.callbacks[b](a)}},broadcast:function(a){!e.closed&&e.fire&&e.fire(d.support.stringifyJSON(a))},
get:function(a){return e.closed?null:e[a]},set:function(a,b){e.closed||(e[a]=b)}}}};g=q.storage()||q.windowref();g.init();k.broadcastable=g;g.set("children",[]);g.set("opened",!1);f();n=setInterval(f,1E3);h.on("_message",e).one("open",function(){g.set("opened",!0);g.broadcast({target:"c",type:"open"})}).one("close",function(a){clearInterval(n);document.cookie=encodeURIComponent(m)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";g.broadcast({target:"c",type:"close",data:{reason:a,heir:v?(g.get("children")||
[])[0]:b.id}});h.off("_message",e)})}g="connecting";var n;0<b.timeout&&(c(),h.one("open",e).one("close",e));b.sharing&&"session"!==k.transport&&l()},open:function(){function a(){d=setTimeout(function(){h.send("heartbeat").one("heartbeat",function(){c();a()});d=setTimeout(function(){f.close();h.fire("close","error")},b._heartbeat)},b.heartbeat-b._heartbeat)}function c(){clearTimeout(d)}g="opened";var d;b.heartbeat>b._heartbeat&&(a(),h.one("close",c));e.connecting.lock();for(s=n=p=null;q.length;)h.send.apply(h,
q.shift())},close:function(){g="closed";var a,c,d=e.close.order;for(a in e)c=e[a],c.order<d&&c.lock();if(b.reconnect)h.one("close",function(){p=p||1;n=b.reconnect.call(h,n,p);!1!==n&&(s=setTimeout(function(){h.open()},n),h.fire("waiting",n,p))})},waiting:function(){g="waiting"},reply:function(a){var b=a.id,c=a.data;a=a.exception;var e=m[b];e&&(a=a?e.fail:e.done)&&(d.support.isFunction(a)?a.call(h,c):h.fire(a,c).fire("_message",[a,c]),delete m[b])}});return h.open()}var u,v,d={},r={},z=[],w=Object.prototype.toString,
B=Object.prototype.hasOwnProperty,x=Array.prototype.slice;d.support={now:function(){return(new Date).getTime()},isArray:function(a){return"[object Array]"===w.call(a)},isBinary:function(a){a=w.call(a);return"[object Blob]"===a||"[object ArrayBuffer]"===a},isFunction:function(a){return"[object Function]"===w.call(a)},getAbsoluteURL:function(a){var c=document.createElement("div");c.innerHTML='<a href="'+a+'"/>';return encodeURI(decodeURI(c.firstChild.href))},iterate:function(a){var c;(function f(){c=
setTimeout(function(){!1!==a()&&f()},1)})();return function(){clearTimeout(c)}},each:function(a,c){var b;for(b=0;b<a.length;b++)c(b,a[b])},extend:function(a){var c,b,d;for(c=1;c<arguments.length;c++)if(null!=(b=arguments[c]))for(d in b)a[d]=b[d];return a},on:function(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent&&a.attachEvent("on"+c,b)},off:function(a,c,b){a.removeEventListener?a.removeEventListener(c,b,!1):a.detachEvent&&a.detachEvent("on"+c,b)},param:function(a){function c(a,
b){b=d.support.isFunction(b)?b():null==b?"":b;g.push(encodeURIComponent(a)+"="+encodeURIComponent(b))}function b(a,f){var g;if(d.support.isArray(f))d.support.each(f,function(d,f){/\[\]$/.test(a)?c(a,f):b(a+"["+("object"===typeof f?d:"")+"]",f)});else if(null!=f&&"[object Object]"===w.call(f))for(g in f)b(a+"["+g+"]",f[g]);else c(a,f)}var f,g=[];for(f in a)b(f,a[f]);return g.join("&").replace(/%20/g,"+")},xhr:function(){try{return new window.XMLHttpRequest}catch(a){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(c){}}},
parseJSON:function(a){return a?window.JSON&&window.JSON.parse?window.JSON.parse(a):(new Function("return "+a))():null},stringifyJSON:function(a){function c(a){return'"'+a.replace(d,function(a){var b=g[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"'}function b(a){return 10>a?"0"+a:a}var d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f",
"\r":"\\r",'"':'\\"',"\\":"\\\\"};return window.JSON&&window.JSON.stringify?window.JSON.stringify(a):function l(a,d){var f,g,p,k=d[a];p=typeof k;k&&"object"===typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(a),p=typeof k);switch(p){case "string":return c(k);case "number":return isFinite(k)?String(k):"null";case "boolean":return String(k);case "object":if(!k)return"null";switch(w.call(k)){case "[object Date]":return isFinite(k.valueOf())?'"'+k.getUTCFullYear()+"-"+b(k.getUTCMonth()+1)+"-"+b(k.getUTCDate())+
"T"+b(k.getUTCHours())+":"+b(k.getUTCMinutes())+":"+b(k.getUTCSeconds())+'Z"':"null";case "[object Array]":g=k.length;p=[];for(f=0;f<g;f++)p.push(l(f,k)||"null");return"["+p.join(",")+"]";default:p=[];for(f in k)B.call(k,f)&&(g=l(f,k))&&p.push(c(f)+":"+g);return"{"+p.join(",")+"}"}}}("",{"":a})},browser:{},storage:!(!window.localStorage||!window.StorageEvent)};d.support.corsable="withCredentials"in d.support.xhr();u=d.support.now();(function(){var a=navigator.userAgent.toLowerCase(),a=/(chrome)[ \/]([\w.]+)/.exec(a)||
/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];d.support.browser[a[1]||""]=!0;d.support.browser.version=a[2]||"0";if(d.support.browser.msie||d.support.browser.mozilla&&"1"===d.support.browser.version.split(".")[0])d.support.storage=!1})();d.find=function(a){var c;if(!arguments.length){for(c in r)if(r[c])return r[c];return null}return r[d.support.getAbsoluteURL(a)]||null};
d.open=function(a,c){a=d.support.getAbsoluteURL(a);r[a]=A(a,c);return d.find(a)};d.defaults={transports:["ws","sse","stream","longpoll"],timeout:!1,heartbeat:!1,_heartbeat:5E3,lastEventId:0,sharing:!1,prepare:function(a){a()},reconnect:function(a){return 2*(a||250)},idGenerator:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"===a?c:c&3|8).toString(16)})},urlBuilder:function(a,c,b){return a+(/\?/.test(a)?"&":"?")+"when="+b+"&"+
d.support.param(c)},inbound:d.support.parseJSON,outbound:d.support.stringifyJSON,credentials:!1,notifyAbort:!1,xdrURL:function(a){var c=/(?:^|; )(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(c&&c[1]){case "JSESSIONID":return a.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+c[2]+"$1");case "PHPSESSID":return a.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+c[2]+"&").replace(/&$/,"");default:return!1}},streamParser:function(a){var c=/\r\n|[\r\n]/g,b=[],d=this.data("data"),g=[],
e=0,l;for(a=a.replace(/^\s+/g,"");l=c.exec(a);)b.push(a.substring(e,l.index)),e=l.index+l[0].length;b.push(a.length===e?"":a.substring(e));d||(d=[],this.data("data",d));for(e=0;e<b.length;e++)(a=b[e])?/^data:\s/.test(a)?d.push(a.substring(6)):d[d.length-1]+=a:(g.push(d.join("\n")),d=[],this.data("data",d));return g}};d.transports={session:function(a,c){function b(a,b){var c,d=a.length;for(c=0;c<d;c++)a[c]===b&&a.splice(c,1);return d!==a.length}function f(b){b=d.support.parseJSON(b);var e=b.data;if(!b.target)"fire"===
b.type&&a.fire(e.type,e.data);else if("c"===b.target)switch(b.type){case "open":a.fire("open");break;case "close":l||(l=!0,"aborted"===e.reason?a.close():e.heir===c.id?a.fire("close",e.reason):setTimeout(function(){a.fire("close",e.reason)},100));break;case "message":if("connecting"===a.state())a.one("open",function(){a.fire.apply(a,e)});else a.fire.apply(a,e)}}function g(){var a=RegExp("(?:^|; )("+encodeURIComponent(q)+")=([^;]*)").exec(document.cookie);if(a)return d.support.parseJSON(decodeURIComponent(a[2]))}
var e,l,m,q="socket-"+c.url,s={storage:function(){function e(a){return d.support.parseJSON(l.getItem(q+"-"+a))}function g(a,b){l.setItem(q+"-"+a,d.support.stringifyJSON(b))}if(d.support.storage){var l=window.localStorage;return{init:function(){function l(a){a.key===q&&a.newValue&&f(a.newValue)}g("children",e("children").concat([c.id]));d.support.on(window,"storage",l);a.one("close",function(){var a=e("children");d.support.off(window,"storage",l);a&&b(a,c.id)&&g("children",a)});return e("opened")},
broadcast:function(a){var b=d.support.stringifyJSON(a);l.setItem(q,b);setTimeout(function(){f(b)},50)}}}},windowref:function(){var e=window.open("",q.replace(/\W/g,""));if(e&&!e.closed&&e.callbacks)return{init:function(){e.callbacks.push(f);e.children.push(c.id);a.one("close",function(){l||(b(e.callbacks,f),b(e.children,c.id))});return e.opened},broadcast:function(a){!e.closed&&e.fire&&e.fire(d.support.stringifyJSON(a))}}}};if((e=g())&&!(1E3<d.support.now()-e.ts)&&(m=s.storage()||s.windowref()))return a.data("broadcastable",
m),{open:function(){var b,l=c.timeout,q=c.heartbeat,s=c.outbound;c.timeout=c.heartbeat=!1;c.outbound=function(a){return a};b=setInterval(function(){var a=e;(e=g())&&a.ts!==e.ts||f(d.support.stringifyJSON({target:"c",type:"close",data:{reason:"error",heir:a.heir}}))},1E3);a.one("close",function(){clearInterval(b);c.timeout=l;c.heartbeat=q;c.outbound=s});m.init()&&setTimeout(function(){a.fire("open")},50)},send:function(a){m.broadcast({target:"p",type:"send",data:a})},close:function(){v||m.broadcast({target:"p",
type:"close"})}}},ws:function(a){var c,b,f=window.WebSocket||window.MozWebSocket;if(f)return{feedback:!0,open:function(){var g=d.support.getAbsoluteURL(a.data("url")).replace(/^http/,"ws");a.data("url",g);c=new f(g);c.onopen=function(b){a.data("event",b).fire("open")};c.onmessage=function(b){a.data("event",b)._fire(b.data)};c.onerror=function(c){a.data("event",c).fire("close",b?"aborted":"error")};c.onclose=function(c){a.data("event",c).fire("close",b?"aborted":c.wasClean?"done":"error")}},send:function(a){c.send(a)},
close:function(){b=!0;c.close()}}},httpbase:function(a,c){function b(){e.length?f(c.url,e.shift()):g=!1}var f,g,e=[];f=!c.crossDomain||d.support.corsable?function(a,e){var f=d.support.xhr();f.onreadystatechange=function(){4===f.readyState&&b()};f.open("POST",a);f.setRequestHeader("Content-Type","text/plain; charset=UTF-8");d.support.corsable&&(f.withCredentials=c.credentials);f.send("data="+e)}:window.XDomainRequest&&c.xdrURL&&c.xdrURL.call(a,"t")?function(e,d){var f=new window.XDomainRequest;f.onload=
f.onerror=b;f.open("POST",c.xdrURL.call(a,e));f.send("data="+d)}:function(a,c){var e=document.createElement("form");e.action=a;e.target="socket-"+ ++u;e.method="POST";e.enctype=e.encoding="text/plain";e.acceptCharset="UTF-8";e.style.display="none";e.innerHTML='<textarea name="data"></textarea><iframe name="'+e.target+'"></iframe>';e.firstChild.value=c;d.support.on(e.lastChild,"load",function(){document.body.removeChild(e);b()});document.body.appendChild(e);e.submit()};return{send:function(a){e.push(a);
g||(g=!0,b())}}},sse:function(a,c){var b,f=window.EventSource;if(f)return d.support.extend(d.transports.httpbase(a,c),{open:function(){var d=a.data("url");b=c.crossDomain?new f(d,{withCredentials:c.credentials}):new f(d);b.onopen=function(b){a.data("event",b).fire("open")};b.onmessage=function(b){a.data("event",b)._fire(b.data)};b.onerror=function(c){b.close();a.data("event",c).fire("close","done")}},close:function(){b.close()}})},stream:function(a){a.data("candidates").unshift("streamxhr","streamxdr",
"streamiframe")},streamxhr:function(a,c){var b;if(!(d.support.browser.msie&&10>+d.support.browser.version||c.crossDomain&&!d.support.corsable))return d.support.extend(d.transports.httpbase(a,c),{open:function(){var f;b=d.support.xhr();b.onreadystatechange=function(){function c(){var e=a.data("index"),d=b.responseText.length;e?d>e&&a._fire(b.responseText.substring(e,d),!0):a.fire("open")._fire(b.responseText,!0);a.data("index",d)}3===b.readyState&&200===b.status?d.support.browser.opera&&!f?f=d.support.iterate(c):
c():4===b.readyState&&(f&&f(),a.fire("close",200===b.status?"done":"error"))};b.open("GET",a.data("url"));d.support.corsable&&(b.withCredentials=c.credentials);b.send(null)},close:function(){b.abort()}})},streamiframe:function(a,c){var b,f,g=window.ActiveXObject;if(g&&!c.crossDomain){try{new g("htmlfile")}catch(e){return}return d.support.extend(d.transports.httpbase(a,c),{open:function(){var c,e;b=new g("htmlfile");b.open();b.close();c=b.createElement("iframe");c.src=a.data("url");b.body.appendChild(c);
e=c.contentDocument||c.contentWindow.document;f=d.support.iterate(function(){function b(){var a=c.cloneNode(!0);a.appendChild(e.createTextNode("."));a=a.innerText;return a.substring(0,a.length-1)}var c;if(e.firstChild){c=e.body.lastChild;if(!c)return a.fire("close","error"),!1;a.fire("open")._fire(b(),!0);c.innerText="";f=d.support.iterate(function(){var d=b();d&&(c.innerText="",a._fire(d,!0));if("complete"===e.readyState)return a.fire("close","done"),!1});return!1}})},close:function(){f();b.execCommand("Stop")}})}},
streamxdr:function(a,c){var b,f=window.XDomainRequest;if(f&&c.xdrURL&&c.xdrURL.call(a,"t"))return d.support.extend(d.transports.httpbase(a,c),{open:function(){var d=c.xdrURL.call(a,a.data("url"));a.data("url",d);b=new f;b.onprogress=function(){var c=a.data("index"),d=b.responseText.length;c?a._fire(b.responseText.substring(c,d),!0):a.fire("open")._fire(b.responseText,!0);a.data("index",d)};b.onerror=function(){a.fire("close","error")};b.onload=function(){a.fire("close","done")};b.open("GET",d);b.send()},
close:function(){b.abort()}})},longpoll:function(a){a.data("candidates").unshift("longpollajax","longpollxdr","longpolljsonp")},longpollajax:function(a,c){var b,f,g=0;if(!c.crossDomain||d.support.corsable)return d.support.extend(d.transports.httpbase(a,c),{open:function(){function e(){var l=a.buildURL(g?"poll":"open",{count:++g});a.data("url",l);b=d.support.xhr();b.onreadystatechange=function(){var c;f||4!==b.readyState||(200===b.status?(c=b.responseText)||1===g?(1===g&&a.fire("open"),c&&a._fire(c),
e()):a.fire("close","done"):a.fire("close","error"))};b.open("GET",l);d.support.corsable&&(b.withCredentials=c.credentials);b.send(null)}e()},close:function(){f=!0;b.abort()}})},longpollxdr:function(a,c){var b,f=0,g=window.XDomainRequest;if(g&&c.xdrURL&&c.xdrURL.call(a,"t"))return d.support.extend(d.transports.httpbase(a,c),{open:function(){function d(){var l=c.xdrURL.call(a,a.buildURL(f?"poll":"open",{count:++f}));a.data("url",l);b=new g;b.onload=function(){var c=b.responseText;c||1===f?(1===f&&
a.fire("open"),c&&a._fire(c),d()):a.fire("close","done")};b.onerror=function(){a.fire("close","error")};b.open("GET",l);b.send()}d()},close:function(){b.abort()}})},longpolljsonp:function(a,c){var b,f,g=0,e=z.pop()||"socket_"+ ++u;return d.support.extend(d.transports.httpbase(a,c),{open:function(){function c(){var d=a.buildURL(g?"poll":"open",{callback:e,count:++g}),q=document.head||document.getElementsByTagName("head")[0]||document.documentElement;a.data("url",d);b=document.createElement("script");
b.async=!0;b.src=d;b.clean=function(){b.clean=b.onerror=b.onload=b.onreadystatechange=null;b.parentNode&&b.parentNode.removeChild(b)};b.onload=b.onreadystatechange=function(){if(!b.readyState||/loaded|complete/.test(b.readyState))b.clean(),f?(f=!1,c()):1===g?(a.fire("open"),c()):a.fire("close","done")};b.onerror=function(){b.clean();a.fire("close","error")};q.insertBefore(b,q.firstChild)}window[e]=function(b){f=!0;1===g&&a.fire("open");a._fire(b)};a.one("close",function(){window[e]=function(){};z.push(e)});
c()},close:function(){b.clean&&b.clean()}})}};d.finalize=function(){var a,c;for(a in r)c=r[a],"closed"!==c.state()&&c.close(),delete r[a]};d.support.on(window,"unload",function(){v=!0;d.finalize()});d.support.on(window,"online",function(){var a,c;for(a in r)c=r[a],"waiting"===c.state()&&c.open()});d.support.on(window,"offline",function(){var a,c;for(a in r)c=r[a],"opened"===c.state()&&c.fire("close","error")});window.portal=d})();