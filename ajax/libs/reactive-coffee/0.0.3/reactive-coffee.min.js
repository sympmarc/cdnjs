(function(){var t,n,e,r,u,o,i,s,c,a,l,h,f,p,d,v,g,m,b,y,x,w,k,S,C,A,M,D,O,R,j,T,P,q,H,N,U,z,B,E,I,F,G,J,K={}.hasOwnProperty,L=function(t,n){function e(){this.constructor=t}for(var r in n)K.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},Q=[].slice,V=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},W=this;"undefined"==typeof exports?this.rx=T={}:T=exports,C=0,S=function(){return C+=1},M=function(t,n){var e;if(!n in t)throw"object has no key "+n;return e=t[n],delete t[n],e},A=function(t,n,e){var r,u,o,i;for(r=o=0,i=t.length;i>o;r=++o)if(u=t[r],e(u)&&0>(n-=1))return[u,r];return[null,-1]},x=function(t,n){return null!=n?t(n):n},b=function(t,n){return A(t,0,n)},w=function(){return Object.create(null)},l=T.Recorder=function(){function t(){this.stack=[]}return t.prototype.start=function(t){return this.stack.push(t)},t.prototype.stop=function(){return this.stack.pop()},t.prototype.sub=function(t){var n,e;return this.stack.length>0?(e=_(this.stack).last(),n=t(e),e.addSub(n)):void 0},t.prototype.warnMutate=function(){return this.stack.length>0?console.warn("Mutation to observable detected during a bind context"):void 0},t}(),j=new l,T.bind=d=function(t){var n;return n=T.depCell(t),n.refresh(),n},T.lagBind=y=function(t,n){var e;return e=T.lagDepCell(n,t),e.refresh(),e},e=T.DepMgr=function(){function t(){this.uid2src={}}return t.prototype.sub=function(t,n){return this.uid2src[t]=n},t.prototype.unsub=function(t){return this.uid2src[t].unsub(t),M(this.uid2src,t)},t}(),v=new e,u=T.Ev=function(){function t(t){this.inits=t,this.subs=[]}return t.prototype.sub=function(t){var n,e,r,u,o;if(e=S(),null!=this.inits)for(o=this.inits(),r=0,u=o.length;u>r;r++)n=o[r],t(n);return this.subs[e]=t,v.sub(e,this),e},t.prototype.pub=function(t){var n,e,r,u;r=this.subs,u=[];for(e in r)n=r[e],u.push(n(t));return u},t.prototype.unsub=function(t){return M(this.subs,t)},t}(),s=T.ObsCell=function(){function t(t){var n,e=this;this.x=t,this.x=null!=(n=this.x)?n:null,this.onSet=new u(function(){return[[null,e.x]]})}return t.prototype.get=function(){var t=this;return j.sub(function(n){return t.onSet.sub(function(){return n.refresh()})}),this.x},t}(),f=T.SrcCell=function(t){function n(){return I=n.__super__.constructor.apply(this,arguments)}return L(n,t),n.prototype.set=function(t){var n;return j.warnMutate(),n=this.x,this.x=t,this.onSet.pub([n,t]),n},n}(s),n=T.DepCell=function(t){function n(t,e,r){this.body=t,n.__super__.constructor.call(this,null!=e?e:null),this.subs=[],this.refreshing=!1,this.lag=null!=r?r:!1,this.timeout=null}return L(n,t),n.prototype.refresh=function(){var t,n=this;return t=function(){var t,e,r,u,o;if(!n.refreshing){for(t=n.x,o=n.subs,r=0,u=o.length;u>r;r++)e=o[r],v.unsub(e);n.subs=[],j.start(n),n.refreshing=!0;try{n.x=n.body()}finally{n.refreshing=!1,j.stop()}return n.onSet.pub([t,n.x])}},this.refreshing?void 0:this.lag?(null!=this.timeout&&clearTimeout(this.timeout),console.log("setting timeout"),this.timeout=setTimeout(t,500)):t()},n.prototype.addSub=function(t){return this.subs.push(t)},n}(s),i=T.ObsArray=function(){function t(t){var n,e=this;this.xs=t,this.xs=null!=(n=this.xs)?n:[],this.onChange=new u(function(){return[[0,[],e.xs]]})}return t.prototype.all=function(){var t=this;return j.sub(function(n){return t.onChange.sub(function(){return n.refresh()})}),this.xs},t.prototype.at=function(t){var n=this;return j.sub(function(e){return n.onChange.sub(function(n){var r,u,o;return u=n[0],o=n[1],r=n[2],u===t?e.refresh():void 0})}),this.xs[t]},t.prototype.length=function(){var t=this;return j.sub(function(n){return t.onChange.sub(function(t){var e,r,u;return r=t[0],u=t[1],e=t[2],u.length!==e.length?n.refresh():void 0})}),this.xs.length},t.prototype.map=function(t){var n;return n=new o,this.onChange.sub(function(e){var r,u,o;return u=e[0],o=e[1],r=e[2],n.realSplice(u,o.length,r.map(t))}),n},t.prototype.realSplice=function(t,n,e){var r;return r=this.xs.splice.apply(this.xs,[t,n].concat(e)),this.onChange.pub([t,r,e])},t}(),h=T.SrcArray=function(t){function n(){return F=n.__super__.constructor.apply(this,arguments)}return L(n,t),n.prototype.spliceArray=function(t,n,e){return j.warnMutate(),this.realSplice(t,n,e)},n.prototype.splice=function(){var t,n,e;return e=arguments[0],n=arguments[1],t=arguments.length>=3?Q.call(arguments,2):[],this.spliceArray(e,n,t)},n.prototype.insert=function(t,n){return this.splice(n,0,t)},n.prototype.remove=function(t){return this.removeAt(_(this.all()).indexOf(t))},n.prototype.removeAt=function(t){return this.splice(t,1)},n.prototype.push=function(t){return this.splice(this.length(),0,t)},n.prototype.put=function(t,n){return this.splice(t,1,n)},n.prototype.replace=function(t){return this.spliceArray(0,this.length(),t)},n}(i),o=T.MappedDepArray=function(t){function n(){return G=n.__super__.constructor.apply(this,arguments)}return L(n,t),n}(i),t=T.DepArray=function(t){function n(t){var e=this;this.f=t,n.__super__.constructor.call(this),d(function(){return e.f()}).onSet.sub(function(t){var n,r,u,o,i,s,c;return o=t[0],i=t[1],null!=o?(s=b(function(){c=[];for(var t=0,n=Math.min(o.length,i.length);n>=0?n>=t:t>=n;n>=0?t++:t--)c.push(t);return c}.apply(this),function(t){return o[t]!==i[t]}),u=s[0],u=s[1]):u=0,u>-1?(r=null!=o?o.length-u:0,n=i.slice(u),e.realSplice(u,r,n)):void 0})}return L(n,t),n}(i),c=T.ObsMap=function(){function t(t){this.x=null!=t?t:{},this.onAdd=new u(function(){var n,e,r;r=[];for(n in t)e=t[n],r.push([n,e]);return r}),this.onRemove=new u,this.onChange=new u}return t.prototype.get=function(t){var n=this;return j.sub(function(e){return n.onChange.sub(function(n){var r,u,o;return u=n[0],r=n[1],o=n[2],t===u?e.refresh():void 0})}),this.x[t]},t.prototype.all=function(){var t=this;return j.sub(function(n){return t.onChange.sub(function(){return n.refresh()})}),_.clone(this.x)},t.prototype.realPut=function(t,n){var e;return V.call(this.x,t)>=0?(e=this.x[t],this.x[t]=n,this.onChange.pub([t,e,n]),e):(this.x[t]=n,this.onAdd.pub([t,n]),void 0)},t.prototype.realRemove=function(t){var n;return n=M(this.x,t),this.onRemove.pub([t,n]),n},t}(),p=T.SrcMap=function(t){function n(){return J=n.__super__.constructor.apply(this,arguments)}return L(n,t),n.prototype.put=function(t,n){return j.warnMutate(),this.realPut(t,n)},n.prototype.remove=function(t){return j.warnMutate(),this.realRemove(t)},n}(c),r=T.DepMap=function(t){function e(t){this.f=t,e.__super__.constructor.call(this),new n(this.f).onSet.sub(function(t){var n,e,r,u,o;e=t[0],u=t[1];for(n in e)r=e[n],!n in u&&this.realRemove(n);o=[];for(n in u)r=u[n],this.x[n]!==r?o.push(this.realPut(n,r)):o.push(void 0);return o})}return L(e,t),e}(c),_.extend(T,{cell:function(t){return new f(t)},array:function(t){return new h(t)},map:function(t){return new p(t)},depCell:function(t){return new n(t)},lagDepCell:function(t,e){return new n(t,e,!0)},depMap:function(t){return new DepMap(t)},depArray:function(n){return new t(n)}}),$.fn.rx=function(t){var n,e,r,u;return r=this.data("rx-map"),null==r&&this.data("rx-map",r=w()),t in r?r[t]:r[t]=function(){var r=this;switch(t){case"focused":return e=T.cell(this.is(":focus")),this.focus(function(){return e.set(!0)}),this.blur(function(){return e.set(!1)}),e;case"val":return u=T.cell(this.val()),this.change(function(){return u.set(r.val())}),this.on("input",function(){return u.set(r.val())}),u;case"checked":return n=T.cell(this.is(":checked")),this.change(function(){return n.set(r.is(":checked"))}),n;default:throw"Unknown reactive property type"}}.call(this)},"undefined"==typeof exports?this.rxt=P={}:P=exports,a=P.RawHtml=function(){function t(t){this.html=t}return t}(),m=["blur","change","click","dblclick","error","focus","focusin","focusout","hover","keydown","keypress","keyup","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","ready","resize","scroll","select","submit","toggle","unload"],H=P.specialAttrs={init:function(t,n){return n.call(t)}},z=function(t){return H[t]=function(n,e){return n[t](function(t){return e.call(n,t)})}};for(B=0,E=m.length;E>B;B++)g=m[B],z(g);R=["async","autofocus","checked","location","multiple","readOnly","selected","selectedIndex","tagName","nodeName","nodeType","ownerDocument","defaultChecked","defaultSelected"],O=_.object(function(){var t,n,e;for(e=[],t=0,n=R.length;n>t;t++)D=R[t],e.push([D,null]);return e}()),q=function(t,n,e){return"value"===n?t.val(e):n in O?t.prop(n,e):t.attr(n,e)},P.mktag=k=function(t){return function(n,e){var r,u,o,c,l,h,f,p,d,v;d=null==n&&null==e?[{},null]:null!=e?[n,e]:_.isString(n)||n instanceof a||_.isArray(n)||n instanceof s||n instanceof i?[{},n]:[n,null],r=d[0],u=d[1],o=$("<"+t+"/>"),v=_.omit(r,_.keys(H));for(l in v)p=v[l],p instanceof s?function(t){return p.onSet.sub(function(n){var e,r;return e=n[0],r=n[1],q(o,t,r)})}(l):q(o,l,p);null!=u&&(h=function(t){var n,e,r,u,o;for(o=[],r=0,u=t.length;u>r;r++)if(n=t[r],_.isString(n))o.push(document.createTextNode(n));else if(n instanceof a){if(e=$(n.html),e.length)throw"Cannot insert RawHtml of multiple elements";o.push(e[0])}else{if(!(n instanceof $))throw"Unknown element type in array: "+n.constructor.name;o.push(n[0])}return o},f=function(t){if(o.html(""),_.isArray(t))return o.append(h(t));if(_.isString(t)||t instanceof a)return f([t]);throw"Unknown type for contents: "+t.constructor.name},u instanceof i?u.onChange.sub(function(t){var n,e,r,u;return e=t[0],r=t[1],n=t[2],o.contents().slice(e,e+r.length).remove(),u=h(n),e===o.contents().length?o.append(u):o.contents().eq(e).before(u)}):u instanceof s?u.onSet.sub(function(t){var n,e;return n=t[0],e=t[1],f(e)}):f(u));for(c in r)c in H&&H[c](o,r[c],r,u);return o}},U=["html","head","title","base","link","meta","style","script","noscript","body","body","section","nav","article","aside","h1","h2","h3","h4","h5","h6","h1","h6","header","footer","address","main","main","p","hr","pre","blockquote","ol","ul","li","dl","dt","dd","dd","figure","figcaption","div","a","em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","br","wbr","ins","del","img","iframe","embed","object","param","object","video","audio","source","video","audio","track","video","audio","canvas","map","area","area","map","svg","math","table","caption","colgroup","col","tbody","thead","tfoot","tr","td","th","form","fieldset","legend","fieldset","label","input","button","select","datalist","optgroup","option","select","datalist","textarea","keygen","output","progress","meter","details","summary","details","menuitem","menu"],P.tags=_.object(function(){var t,n,e;for(e=[],t=0,n=U.length;n>t;t++)N=U[t],e.push([N,P.mktag(N)]);return e}()),P.rawHtml=function(t){return new a(t)},P.importTags=function(t){return _(null!=t?t:W).extend(P.tags)}}).call(this);