!function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S={}.hasOwnProperty,T=function(a,b){function c(){this.constructor=a}for(var d in b)S.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},U=[].slice,V=this;"undefined"==typeof exports?this.rx=F={}:F=exports,y=0,x=function(){return y+=1},A=function(a,b){var c;if(!b in a)throw"object has no key "+b;return c=a[b],delete a[b],c},z=function(a,b,c){var d,e,f,g;for(d=f=0,g=a.length;g>f;d=++f)if(e=a[d],c(e)&&(b-=1)<0)return[e,d];return[null,-1]},u=function(a,b){return null!=b?a(b):b},s=function(a,b){return z(a,0,b)},v=function(){return Object.create(null)},k=F.Recorder=function(){function a(){this.stack=[]}return a.prototype.start=function(a){return this.stack.length>0&&_(this.stack).last().addNestedBind(a),this.stack.push(a)},a.prototype.stop=function(){return this.stack.pop()},a.prototype.sub=function(a){var b,c;return this.stack.length>0?(c=_(this.stack).last(),b=a(c),c.addSub(b)):void 0},a.prototype.warnMutate=function(){return this.stack.length>0?console.warn("Mutation to observable detected during a bind context"):void 0},a}(),E=new k,F.bind=o=function(a){var c;return c=new b(a),c.refresh(),c},F.lagBind=t=function(a,c){var d;return d=new b(c,a),d.refresh(),d},d=F.DepMgr=function(){function a(){this.uid2src={}}return a.prototype.sub=function(a,b){return this.uid2src[a]=b},a.prototype.unsub=function(a){return this.uid2src[a].unsub(a),A(this.uid2src,a)},a}(),p=new d,e=F.Ev=function(){function a(a){this.inits=a,this.subs=[]}return a.prototype.sub=function(a){var b,c,d,e,f;if(c=x(),null!=this.inits)for(f=this.inits(),d=0,e=f.length;e>d;d++)b=f[d],a(b);return this.subs[c]=a,p.sub(c,this),c},a.prototype.pub=function(a){var b,c,d,e;d=this.subs,e=[];for(c in d)b=d[c],e.push(b(a));return e},a.prototype.unsub=function(a){return A(this.subs,a)},a}(),h=F.ObsCell=function(){function a(a){var b,c=this;this.x=a,this.x=null!=(b=this.x)?b:null,this.onSet=new e(function(){return[[null,c.x]]})}return a.prototype.get=function(){var a=this;return E.sub(function(b){return a.onSet.sub(function(){return b.refresh()})}),this.x},a}(),m=F.SrcCell=function(a){function b(){return O=b.__super__.constructor.apply(this,arguments)}return T(b,a),b.prototype.set=function(a){var b;return E.warnMutate(),b=this.x,this.x=a,this.onSet.pub([b,a]),b},b}(h),b=F.DepCell=function(a){function b(a,c,d){this.body=a,b.__super__.constructor.call(this,null!=c?c:null),this.subs=[],this.refreshing=!1,this.lag=null!=d?d:!1,this.timeout=null,this.nestedBinds=[]}return T(b,a),b.prototype.refresh=function(){var a,b=this;return a=function(){var a;if(!b.refreshing){a=b.x,b.disconnect(),E.start(b),b.refreshing=!0;try{b.x=b.body()}finally{b.refreshing=!1,E.stop()}return b.onSet.pub([a,b.x])}},this.refreshing?void 0:this.lag?(null!=this.timeout&&clearTimeout(this.timeout),console.log("setting timeout"),this.timeout=setTimeout(a,500)):a()},b.prototype.disconnect=function(){var a,b,c,d,e,f,g,h;for(g=this.subs,c=0,e=g.length;e>c;c++)b=g[c],p.unsub(b);for(h=this.nestedBinds,d=0,f=h.length;f>d;d++)a=h[d],a.disconnect();return this.subs=[],this.nestedBinds=[]},b.prototype.addSub=function(a){return this.subs.push(a)},b.prototype.addNestedBind=function(a){return this.nestedBinds.push(a)},b}(h),g=F.ObsArray=function(){function a(a){var b,c=this;this.xs=a,this.xs=null!=(b=this.xs)?b:[],this.onChange=new e(function(){return[[0,[],c.xs]]})}return a.prototype.all=function(){var a=this;return E.sub(function(b){return a.onChange.sub(function(){return b.refresh()})}),this.xs},a.prototype.at=function(a){var b=this;return E.sub(function(c){return b.onChange.sub(function(b){var d,e,f;return e=b[0],f=b[1],d=b[2],e===a?c.refresh():void 0})}),this.xs[a]},a.prototype.length=function(){var a=this;return E.sub(function(b){return a.onChange.sub(function(a){var c,d,e;return d=a[0],e=a[1],c=a[2],e.length!==c.length?b.refresh():void 0})}),this.xs.length},a.prototype.map=function(a){var b;return b=new f,this.onChange.sub(function(c){var d,e,f;return e=c[0],f=c[1],d=c[2],b.realSplice(e,f.length,d.map(a))}),b},a.prototype.realSplice=function(a,b,c){var d;return d=this.xs.splice.apply(this.xs,[a,b].concat(c)),this.onChange.pub([a,d,c])},a}(),l=F.SrcArray=function(a){function b(){return P=b.__super__.constructor.apply(this,arguments)}return T(b,a),b.prototype.spliceArray=function(a,b,c){return E.warnMutate(),this.realSplice(a,b,c)},b.prototype.splice=function(){var a,b,c;return c=arguments[0],b=arguments[1],a=3<=arguments.length?U.call(arguments,2):[],this.spliceArray(c,b,a)},b.prototype.insert=function(a,b){return this.splice(b,0,a)},b.prototype.remove=function(a){return this.removeAt(_(this.all()).indexOf(a))},b.prototype.removeAt=function(a){return this.splice(a,1)},b.prototype.push=function(a){return this.splice(this.length(),0,a)},b.prototype.put=function(a,b){return this.splice(a,1,b)},b.prototype.replace=function(a){return this.spliceArray(0,this.length(),a)},b}(g),f=F.MappedDepArray=function(a){function b(){return Q=b.__super__.constructor.apply(this,arguments)}return T(b,a),b}(g),a=F.DepArray=function(a){function b(a){var c=this;this.f=a,b.__super__.constructor.call(this),o(function(){return c.f()}).onSet.sub(function(a){var b,d,e,f,g,h,i;return f=a[0],g=a[1],null!=f?(h=s(function(){i=[];for(var a=0,b=Math.min(f.length,g.length);b>=0?b>=a:a>=b;b>=0?a++:a--)i.push(a);return i}.apply(this),function(a){return f[a]!==g[a]}),e=h[0],e=h[1]):e=0,e>-1?(d=null!=f?f.length-e:0,b=g.slice(e),c.realSplice(e,d,b)):void 0})}return T(b,a),b}(g),i=F.ObsMap=function(){function a(a){this.x=null!=a?a:{},this.onAdd=new e(function(){var b,c,d;d=[];for(b in a)c=a[b],d.push([b,c]);return d}),this.onRemove=new e,this.onChange=new e}return a.prototype.get=function(a){var b=this;return E.sub(function(c){return b.onAdd.sub(function(b){var d,e;return d=b[0],e=b[1],a===d?c.refresh():void 0})}),E.sub(function(c){return b.onChange.sub(function(b){var d,e,f;return e=b[0],d=b[1],f=b[2],a===e?c.refresh():void 0})}),E.sub(function(c){return b.onRemove.sub(function(b){var d,e;return e=b[0],d=b[1],a===e?c.refresh():void 0})}),this.x[a]},a.prototype.all=function(){var a=this;return E.sub(function(b){return a.onAdd.sub(function(){return b.refresh()})}),E.sub(function(b){return a.onChange.sub(function(){return b.refresh()})}),E.sub(function(b){return a.onRemove.sub(function(){return b.refresh()})}),_.clone(this.x)},a.prototype.realPut=function(a,b){var c;return a in this.x?(c=this.x[a],this.x[a]=b,this.onChange.pub([a,c,b]),c):(this.x[a]=b,this.onAdd.pub([a,b]),void 0)},a.prototype.realRemove=function(a){var b;return b=A(this.x,a),this.onRemove.pub([a,b]),b},a}(),n=F.SrcMap=function(a){function b(){return R=b.__super__.constructor.apply(this,arguments)}return T(b,a),b.prototype.put=function(a,b){return E.warnMutate(),this.realPut(a,b)},b.prototype.remove=function(a){return E.warnMutate(),this.realRemove(a)},b}(i),c=F.DepMap=function(a){function c(a){this.f=a,c.__super__.constructor.call(this),new b(this.f).onSet.sub(function(a){var b,c,d,e,f;c=a[0],e=a[1];for(b in c)d=c[b],!b in e&&this.realRemove(b);f=[];for(b in e)d=e[b],this.x[b]!==d?f.push(this.realPut(b,d)):f.push(void 0);return f})}return T(c,a),c}(i),_.extend(F,{cell:function(a){return new m(a)},array:function(a){return new l(a)},map:function(a){return new n(a)}}),$.fn.rx=function(a){var b,c,d,e;return d=this.data("rx-map"),null==d&&this.data("rx-map",d=v()),a in d?d[a]:d[a]=function(){var d=this;switch(a){case"focused":return c=F.cell(this.is(":focus")),this.focus(function(){return c.set(!0)}),this.blur(function(){return c.set(!1)}),c;case"val":return e=F.cell(this.val()),this.change(function(){return e.set(d.val())}),this.on("input",function(){return e.set(d.val())}),e;case"checked":return b=F.cell(this.is(":checked")),this.change(function(){return b.set(d.is(":checked"))}),b;default:throw"Unknown reactive property type"}}.call(this)},"undefined"==typeof exports?this.rxt=G={}:G=exports,j=G.RawHtml=function(){function a(a){this.html=a}return a}(),r=["blur","change","click","dblclick","error","focus","focusin","focusout","hover","keydown","keypress","keyup","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","ready","resize","scroll","select","submit","toggle","unload"],I=G.specialAttrs={init:function(a,b){return b.call(a)}},L=function(a){return I[a]=function(b,c){return b[a](function(a){return c.call(b,a)})}};for(M=0,N=r.length;N>M;M++)q=r[M],L(q);D=["async","autofocus","checked","location","multiple","readOnly","selected","selectedIndex","tagName","nodeName","nodeType","ownerDocument","defaultChecked","defaultSelected"],C=_.object(function(){var a,b,c;for(c=[],a=0,b=D.length;b>a;a++)B=D[a],c.push([B,null]);return c}()),H=function(a,b,c){return"value"===b?a.val(c):b in C?a.prop(b,c):a.attr(b,c)},G.mktag=w=function(a){return function(b,c){var d,e,f,i,k,l,m,n,o,p;o=null==b&&null==c?[{},null]:null!=c?[b,c]:_.isString(b)||b instanceof j||_.isArray(b)||b instanceof h||b instanceof g?[{},b]:[b,null],d=o[0],e=o[1],f=$("<"+a+"/>"),p=_.omit(d,_.keys(I));for(k in p)n=p[k],n instanceof h?function(a){return n.onSet.sub(function(b){var c,d;return c=b[0],d=b[1],H(f,a,d)})}(k):H(f,k,n);null!=e&&(l=function(a){var b,c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)if(b=a[d],_.isString(b))f.push(document.createTextNode(b));else if(b instanceof j){if(c=$(b.html),c.length)throw"Cannot insert RawHtml of multiple elements";f.push(c[0])}else{if(!(b instanceof $))throw"Unknown element type in array: "+b.constructor.name;f.push(b[0])}return f},m=function(a){if(f.html(""),_.isArray(a))return f.append(l(a));if(_.isString(a)||a instanceof j)return m([a]);throw"Unknown type for contents: "+a.constructor.name},e instanceof g?e.onChange.sub(function(a){var b,c,d,e;return c=a[0],d=a[1],b=a[2],f.contents().slice(c,c+d.length).remove(),e=l(b),c===f.contents().length?f.append(e):f.contents().eq(c).before(e)}):e instanceof h?e.onSet.sub(function(a){var b,c;return b=a[0],c=a[1],m(c)}):m(e));for(i in d)i in I&&I[i](f,d[i],d,e);return f}},K=["html","head","title","base","link","meta","style","script","noscript","body","body","section","nav","article","aside","h1","h2","h3","h4","h5","h6","h1","h6","header","footer","address","main","main","p","hr","pre","blockquote","ol","ul","li","dl","dt","dd","dd","figure","figcaption","div","a","em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","br","wbr","ins","del","img","iframe","embed","object","param","object","video","audio","source","video","audio","track","video","audio","canvas","map","area","area","map","svg","math","table","caption","colgroup","col","tbody","thead","tfoot","tr","td","th","form","fieldset","legend","fieldset","label","input","button","select","datalist","optgroup","option","select","datalist","textarea","keygen","output","progress","meter","details","summary","details","menuitem","menu"],G.tags=_.object(function(){var a,b,c;for(c=[],a=0,b=K.length;b>a;a++)J=K[a],c.push([J,G.mktag(J)]);return c}()),G.rawHtml=function(a){return new j(a)},G.importTags=function(a){return _(null!=a?a:V).extend(G.tags)}}.call(this);